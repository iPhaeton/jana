{"version":3,"sources":["webpack:///webpack/bootstrap dbe0839ec0362f992761","webpack:///./shopClient.js","webpack:///./headMenu.js","webpack:///./modals.js","webpack:///./ajaxClient.js","webpack:///./axillaries.js","webpack:///./searchPanel.js"],"names":["mode","thumbnails","storedData","storedConfig","searchPanel","socket","SockConnection","window","location","origin","connect","$","document","ready","editPanel","EditPanel","body","css","height","popups","on","event","target","findTarget","preventDefault","sideMenuActive","getData","attr","createContent","url","callback","submit","config","data","async","parallel","err","results","parseConfig","alert","clear","Thumbnails","build","render","field","showcase","Function","elem","tiles","Set","previousWindowWidth","focusExecuted","setHandlers","prototype","doc","add","Thumbnail","row","tile","append","clearTiles","dataToAdd","done","newThumbnail","push","html","unrender","executeAnyway","windowWidth","width","arrangeClears","bind","clearThis","removeClass","i","addClass","off","parent","dataUrl","img","undefined","specs","details","self","withTitle","color","split","col","div","textAlign","hover","cursor","chooseImage","button","fields","length","p","showPopupMenu","trigger","_id","chooseImageOnServer","text","message","showDirList","list","messge","files","showDirPopupMenu","menu","PopupMenu","remove","selectedImage","showImage","deleteImage","hasClass","popupMenu","delete","parentList","iframe","appendTo","position","top","left","background","zIndex","contents","find","EditSwitch","float","margin","switchMode","createUploadInput","toggle","uploadInput","border","padding","callerId","id","switch","buttonClick","addCommodity","addCategory","removeAttr","questionnaire","dialog","form","formData","serializeArray","name","value","invokingEvent","items","unremovable","item","addField","itemName","onclick","oncontextmenu","close","offset","clientX","scrollLeft","pageXOffset","documentElement","clientWidth","get","offsetWidth","clientY","scrollTop","detach","headMenuListener","showAuthWindow","href","keyCode","authWindow","Details","ModalWindow","call","Object","create","constructor","content","saveButton","addButton","cancelButton","editButtonClick","_render","panel","table","key","val","prepend","removeField","blur","container","children","num","eq","Dialog","db","createData","fakeParent","AuthWindow","type","borderRadius","minWidth","reload","preventScrolling","closeButton","closeImg","clearFix","insertAfter","visibility","setTimeout","win","prevent","overflow","makeDBSearchRequest","reqStr","ajax","dataType","json","fail","xhr","status","makeDBSaveRequest","statusCode","jqXHR","JSON","parse","responseText","makeDBDelRequest","makeFileSaveRequest","file","headers","processData","contentType","makeFileDeleteRequest","makeListRequest","makeAuthorizationRequest","serialize","criteria","tag","gatherItemsInOrder","obj","SearchPanel","options","toggleButton","input","setEvents","SearchPanelPopupControl","ctrlKey","shiftKey","hidePopups","unsetEvents","hide","toggleClass","request","searchData","popup","shop","makeSearchRequest","showSearchResult","send","stringify","defineProperty","_data","getValues","values","createCol","bodyWidth","Math","ceil","handleBodySize","clearTimeout","handleBodySizeTimer","outerHeight","right"],"mappings":";;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;ACtCA;;;;;;;AAEA;;;;AACA;;AAKA;;AACA;;;;AACA;;;;AAEA,KAAIA,OAAO,MAAX;;AAEA,KAAIC,UAAJ,EACIC,UADJ,EACgB;AACZC,aAFJ,EAEkB;AACdC,YAHJ;;AAKA,KAAIC,SAAS,IAAIC,cAAJ,CAAmBC,OAAOC,QAAP,CAAgBC,MAAhB,GAAyB,OAA5C,CAAb;AACAJ,QAAOK,OAAP;;AAEAC,GAAEC,QAAF,EAAYC,KAAZ,CAAkB,YAAY;AAC1B;;AAEA,SAAIC,YAAY,IAAIC,SAAJ,EAAhB;;AAEAJ,OAAEC,SAASI,IAAX,EAAiBC,GAAjB,CAAqB;AACjBC,iBAAQP,EAAEJ,MAAF,EAAUW,MAAV;AADS,MAArB;;AAIAd,mBAAc,0BAAgB;AAC1Be,iBAAO,CACH,eADG;AADmB,MAAhB,CAAd;;AAMAR,OAAE,YAAF,EAAgBS,EAAhB,CAAmB,OAAnB,EAA4B,cAA5B,EAA4C,UAAUC,KAAV,EAAiB;AACzD,aAAIC,SAASX,EAAEU,MAAMC,MAAR,CAAb;AACAA,kBAASC,WAAWD,MAAX,EAAmB,aAAnB,EAAkC,GAAlC,CAAT;AACA,aAAG,CAACA,MAAJ,EAAY;AACRD,mBAAMG,cAAN;AACA;AACH;;AAEDC,wBAAeH,MAAf;;AAEAI,iBAAQJ,OAAOK,IAAP,CAAY,MAAZ,CAAR,EAA6BC,aAA7B;;AAEAP,eAAMG,cAAN;AACH,MAbD;AAcH,EA7BD;;AA+BA,UAASE,OAAT,CAAiBG,GAAjB,EAAsBC,QAAtB,EAAgC;AAC5B,SAAID,QAAQ,QAAZ,EAAsB;AAClBzB,qBAAY2B,MAAZ;AACA;AACH;;AAED,SAAIC,MAAJ,EACIC,IADJ;;AAGAC,WAAMC,QAAN,CAAe;AACX;AACA,eAAUL,QAAV,EAAoB;AAChB,8CAAoB,qBAApB,EAA2CA,QAA3C;AACH,MAJU,EAKX,UAAUA,QAAV,EAAoB;AAChB,8CAAoBD,GAApB,EAAyBC,QAAzB;AACH,MAPU,CAAf,EAQG,UAAUM,GAAV,EAAeC,OAAf,EAAwB;AACvB,iBA2hBAlC,YA3hBA,kBAAe6B,SAASM,YAAYD,QAAQ,CAAR,EAAW,CAAX,CAAZ,CAAxB;AACA,iBA0hBcnC,UA1hBd,gBAAa+B,OAAOI,QAAQ,CAAR,CAApB;AACAJ,cAAKJ,GAAL,GAAWA,GAAX;;AAEA,aAAIO,GAAJ,EAAS;AACLG,mBAAM,mCAAN;AACA;AACH;;AAEDT,kBAASG,IAAT,EAAeD,MAAf;AACH,MAnBD;AAoBH;;AAED,UAASJ,aAAT,CAAwBK,IAAxB,EAA8BD,MAA9B,EAAsC;AAClC;AACA;AACA,SAAIC,OAAOA,QAAQ/B,UAAnB;AAAA,SACI8B,SAASA,UAAU7B,YADvB;;AAGA,SAAI,CAAC8B,IAAD,IAAShC,UAAb,EAAyB;AACrBA,oBAAWuC,KAAX;AACH;AACD,SAAG,CAACR,MAAJ,EAAY;;AAEZ,SAAI,CAAC/B,UAAL,EAAiB,QAmgBkCA,UAngBlC,gBAAa,IAAIwC,UAAJ,CAAe,iBAAf,EAAkCR,IAAlC,EAAwCD,MAAxC,CAAb;AACjB/B,gBAAWuC,KAAX;AACAvC,gBAAWyC,KAAX,CAAiBT,IAAjB,EAAuBD,MAAvB;AACA/B,gBAAW0C,MAAX;AACH;;AAED;AACA,UAASL,WAAT,CAAqBN,MAArB,EAA6B;AACzB,UAAK,IAAIY,KAAT,IAAkBZ,OAAOa,QAAzB,EAAmC;AAC/B,aAAIb,OAAOa,QAAP,CAAgBD,KAAhB,EAAuB3B,GAA3B,EAAgC;AAC5Be,oBAAOa,QAAP,CAAgBD,KAAhB,EAAuB3B,GAAvB,GAA6B,IAAI6B,QAAJ,CAAc,MAAd,EAAsBd,OAAOa,QAAP,CAAgBD,KAAhB,EAAuB3B,GAA7C,CAA7B;AACH;AACJ;;AAED,YAAOe,MAAP;AACH;;AAED;AACA,UAASS,UAAT,CAAqBM,IAArB,EAA2Bf,MAA3B,EAAmC;AAC/B,UAAKe,IAAL,GAAYpC,EAAEoC,IAAF,CAAZ;AACA,UAAKC,KAAL,GAAa,IAAIC,GAAJ,EAAb;AACA,UAAKC,mBAAL,GAA2B,CAA3B;AACA,UAAKC,aAAL,GAAqB,KAArB;;AAEA,UAAKlB,IAAL,GAAY,EAAZ;;AAEA,UAAKmB,WAAL;AACH;;AAEDX,YAAWY,SAAX,CAAqBX,KAArB,GAA6B,UAAUT,IAAV,EAAgBD,MAAhB,EAAwB;AACjD,SAAI,CAACC,IAAL,EAAW;;AAEX,UAAKA,IAAL,GAAYA,IAAZ;AACA,UAAKD,MAAL,GAAcA,MAAd;;AAJiD;AAAA;AAAA;;AAAA;AAMjD,8BAAgB,KAAKC,IAArB,8HAA2B;AAAA,iBAAlBqB,GAAkB;;AACvB,kBAAKN,KAAL,CAAWO,GAAX,CAAgB,IAAIC,SAAJ,CAAc,IAAd,EAAoBF,GAApB,EAAyB,KAAKtB,MAA9B,EAAsC,KAAKC,IAAL,CAAUJ,GAAhD,CAAD,CAAuDkB,IAAtE;AACH;AARgD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAQhD;AACJ,EATD;;AAWAN,YAAWY,SAAX,CAAqBV,MAArB,GAA8B,YAAY;AACtC,UAAKc,GAAL,GAAW9C,EAAE,yBAAF,CAAX;;AADsC;AAAA;AAAA;;AAAA;AAGtC,+BAAiB,KAAKqC,KAAtB,mIAA6B;AAAA,iBAApBU,IAAoB;;AACzB,kBAAKD,GAAL,CAASE,MAAT,CAAgBD,IAAhB;AACH;AALqC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAKrC;;AAED,UAAKX,IAAL,CAAUY,MAAV,CAAiB,KAAKF,GAAtB;;AAEA,UAAKG,UAAL,CAAgB,IAAhB;AACH,EAVD;;AAYAnB,YAAWY,SAAX,CAAqBE,GAArB,GAA2B,UAAUM,SAAV,EAAqBC,IAArB,EAA2B;AAClD,SAAI,CAAC,KAAKL,GAAV,EAAe;AACX,cAAKA,GAAL,GAAW9C,EAAE,yBAAF,CAAX;AACA,cAAKoC,IAAL,CAAUY,MAAV,CAAiB,KAAKF,GAAtB;AACH;;AAED,SAAIM,eAAgB,IAAIP,SAAJ,CAAc,IAAd,EAAoBK,SAApB,EAA+B,KAAK7B,MAAL,IAAe7B,YAA9C,EAA4D,QAA5D,CAApB;;AAEA,UAAK6C,KAAL,CAAWO,GAAX,CAAeQ,aAAahB,IAA5B;AACA,UAAKU,GAAL,CAASE,MAAT,CAAgBI,aAAahB,IAA7B;AACA,UAAKa,UAAL,CAAgB,IAAhB;;AAEA,UAAK3B,IAAL,CAAU+B,IAAV,CAAeH,SAAf;AACA,aAkckB3D,UAlclB,gBAAa,KAAK+B,IAAlB;;AAEA,SAAI6B,IAAJ,EAAU;AACN,cAAKF,UAAL,CAAgB,IAAhB;AACH;AACJ,EAlBD;;AAoBAnB,YAAWY,SAAX,CAAqBb,KAArB,GAA6B,YAAY;AACrC,UAAKP,IAAL,GAAY,EAAZ;AACA,UAAKe,KAAL,CAAWR,KAAX;AACA,SAAI,KAAKiB,GAAT,EAAc,KAAKA,GAAL,CAASQ,IAAT,CAAc,EAAd;AACjB,EAJD;;AAMAxB,YAAWY,SAAX,CAAqBa,QAArB,GAAgC,YAAY;AACxC,UAAKnB,IAAL,CAAUkB,IAAV,CAAe,EAAf;AACH,EAFD;;AAIA;AACA;AACAxB,YAAWY,SAAX,CAAqBO,UAArB,GAAkC,UAAUO,aAAV,EAAyB;;AAEvD,YAAO,YAAY;AACf,aAAIC,cAAczD,EAAEJ,MAAF,EAAU8D,KAAV,EAAlB;;AAEA,aAAID,cAAc,GAAlB,EAAuB;AACnB,iBAAI,KAAKlB,mBAAL,IAA4B,GAA5B,IAAmCiB,aAAvC,EAAsD;AAClD,sBAAKG,aAAL;AACH;AACJ,UAJD,MAIO,IAAIF,eAAe,GAAf,IAAsBA,cAAc,GAAxC,EAA6C;AAChD,iBAAI,KAAKlB,mBAAL,GAA2B,GAA3B,IAAkC,KAAKA,mBAAL,IAA4B,GAA9D,IAAqEiB,aAAzE,EAAwF;AACpF,sBAAKG,aAAL,CAAmB,CAAnB;AACH;AACJ,UAJM,MAIA,IAAIF,eAAe,GAAf,IAAsBA,cAAc,IAAxC,EAA8C;AACjD,iBAAI,KAAKlB,mBAAL,GAA2B,GAA3B,IAAkC,KAAKA,mBAAL,IAA4B,IAA9D,IAAsEiB,aAA1E,EAAyF;AACrF,sBAAKG,aAAL,CAAmB,CAAnB;AACH;AACJ,UAJM,MAIA;AACH,iBAAI,KAAKpB,mBAAL,GAA2B,IAA3B,IAAmCiB,aAAvC,EAAsD;AAClD,sBAAKG,aAAL,CAAmB,CAAnB;AACH;AACJ;;AAED,cAAKpB,mBAAL,GAA2BkB,WAA3B;AACH,MAtBM,CAsBLG,IAtBK,CAsBA,IAtBA,CAAP;AAwBH,EA1BD;;AA4BA;AACA9B,YAAWY,SAAX,CAAqBiB,aAArB,GAAqC,UAAUE,SAAV,EAAqB;AACtD,SAAI,CAACA,SAAL,EAAgB;AACZ,cAAK,IAAId,IAAT,IAAiB,KAAKV,KAAtB,EAA6B;AACzBU,kBAAKe,WAAL,CAAiB,gBAAjB;AACH;AACD;AACH;;AAEDD;;AAEA,SAAIE,IAAI,CAAR;AAVsD;AAAA;AAAA;;AAAA;AAWtD,+BAAiB,KAAK1B,KAAtB,mIAA6B;AAAA,iBAApBU,IAAoB;;AACzB,iBAAIgB,IAAEF,SAAF,KAAgB,CAApB,EAAuB;AACnBd,sBAAKiB,QAAL,CAAc,gBAAd;AACH,cAFD,MAEO;AACHjB,sBAAKe,WAAL,CAAiB,gBAAjB;AACH;AACDC;AACH;AAlBqD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAkBrD;AACJ,EAnBD;;AAqBAjC,YAAWY,SAAX,CAAqBD,WAArB,GAAmC,YAAY;AAC3CzC,OAAEJ,MAAF,EAAUa,EAAV,CAAa,QAAb,EAAuB,KAAKwC,UAAL,CAAgB,KAAhB,CAAvB;;AAEA;AACA;AACAjD,OAAEC,QAAF,EAAYQ,EAAZ,CAAe,OAAf,EAAwB,YAAY;AAChC,aAAI,KAAK+B,aAAT,EAAwB;;AAExB,cAAKA,aAAL,GAAqB,IAArB;;AAEA,cAAKS,UAAL,CAAgB,IAAhB;AACAjD,WAAEJ,MAAF,EAAUqE,GAAV,CAAc,QAAd,EAAwB,KAAKhB,UAAL,CAAgB,KAAhB,CAAxB,EANgC,CAMiB;AACjDjD,WAAEJ,MAAF,EAAUa,EAAV,CAAa,QAAb,EAAuB,KAAKwC,UAAL,CAAgB,KAAhB,CAAvB,EAPgC,CAOgB;AACnD,MARuB,CAQtBW,IARsB,CAQjB,IARiB,CAAxB;;AAUA;AACA5D,OAAEC,QAAF,EAAYQ,EAAZ,CAAe,OAAf,EAAwB,UAAUC,KAAV,EAAiB;AACrC,aAAIV,EAAEU,MAAMC,MAAR,EAAgBK,IAAhB,CAAqB,MAArB,CAAJ,EAAkC,KAAKwB,aAAL,GAAqB,KAArB;AAClCxC,WAAEJ,MAAF,EAAUqE,GAAV,CAAc,QAAd,EAAwB,KAAKhB,UAAL,CAAgB,KAAhB,CAAxB,EAFqC,CAEY;AACjDjD,WAAEJ,MAAF,EAAUa,EAAV,CAAa,QAAb,EAAuB,KAAKwC,UAAL,CAAgB,KAAhB,CAAvB,EAHqC,CAGW;AACnD,MAJuB,CAItBW,IAJsB,CAIjB,IAJiB,CAAxB;AAKH,EArBD;;AAuBA;AACA,UAASf,SAAT,CAAoBqB,MAApB,EAA4B5C,IAA5B,EAAkCD,MAAlC,EAA0C8C,OAA1C,EAAmD;AAC/C,UAAKD,MAAL,GAAcA,MAAd;AACA,UAAK5C,IAAL,GAAYA,QAAQ;AAChB8C,cAAKC,SADW;AAEhBC,gBAAM;AAFU,MAApB;AAIA,UAAKH,OAAL,GAAeA,OAAf;AACA,UAAKI,OAAL,GAAe,oBAAY,IAAZ,CAAf;AACA,SAAIC,OAAO,IAAX;;AAEA;AACA,SAAI,CAACnD,MAAL,EAAa;AACTA,kBAAS;AACLa,uBAAU;AACN,6BAAY;AACRuC,gCAAW;AADH,kBADN;AAIN,yBAAQ;AACJA,gCAAW,KADP;AAEJnE,0BAAK;AACDoE,gCAAO;AADN;AAFD,kBAJF;AAUN,8BAAa;AACTD,gCAAW,IADF;AAETnE,0BAAM,CAAEgB,KAAKgD,KAAL,CAAW,WAAX,EAAwBK,KAAxB,CAA8B,GAA9B,EAAmC,CAAnC,CAAF,GAA2C;AAC7CD,gCAAO;AADsC,sBAA3C,GAEF;AACAA,gCAAO;AADP;AAJK;AAVP;AADL,UAAT;AAqBH;;AAED,SAAIE,MAAM5E,EAAE,gDAAF,CAAV;;AAEA,SAAI6E,MAAM7E,EAAE,+BAAF,CAAV;AACA6E,SAAIvE,GAAJ,CAAQ;AACJwE,oBAAW;AADP,MAAR;;AAIA,SAAIV,MAAMpE,EAAE,eAAe,KAAKsB,IAAL,CAAU8C,GAAV,IAAiB,yBAAhC,IAA6D,yBAA/D,CAAV;AACA;AACA,SAAI/E,SAAS,MAAb,EAAqB;AACjB+E,aAAIW,KAAJ,CAAU,YAAY;AAClB/E,eAAE,IAAF,EAAQM,GAAR,CAAY;AACR0E,yBAAQ;AADA,cAAZ;AAGH,UAJD;AAKAZ,aAAI3D,EAAJ,CAAO,OAAP,EAAgB,KAAKwE,WAAL,CAAiBrB,IAAjB,CAAsB,IAAtB,CAAhB;AACH;;AAED,SAAIsB,SAASlF,EAAE,6GAA6GX,SAAS,MAAT,GAAiB,aAAjB,GAAiC,iBAA9I,IAAmK,WAArK,CAAb;AACA6F,YAAOzE,EAAP,CAAU,OAAV,EAAmB,UAAUC,KAAV,EAAiB;AAChC8D,cAAKD,OAAL,CAAavC,MAAb;AACH,MAFD;;AAIA6C,SAAI7B,MAAJ,CAAWoB,GAAX;;AAEA,SAAIe,SAAS,oCAAmB9D,OAAOa,QAA1B,CAAb;AACA,UAAK,IAAI6B,IAAIoB,OAAOC,MAAP,GAAc,CAA3B,EAA8BrB,KAAK,CAAnC,EAAsCA,GAAtC,EAA2C;AACvC,aAAI,KAAKzC,IAAL,CAAUgD,KAAV,CAAgBa,OAAOpB,CAAP,CAAhB,CAAJ,EAAgC;AAC5B,iBAAIsB,IAAIrF,EAAE,SAAUqB,OAAOa,QAAP,CAAgBiD,OAAOpB,CAAP,CAAhB,EAA2BU,SAA5B,GAA0CU,OAAOpB,CAAP,IAAY,IAAZ,GAAmB,KAAKzC,IAAL,CAAUgD,KAAV,CAAgBa,OAAOpB,CAAP,CAAhB,CAA7D,GAA4F,KAAKzC,IAAL,CAAUgD,KAAV,CAAgBa,OAAOpB,CAAP,CAAhB,CAArG,IAAoI,MAAtI,CAAR;AACA,iBAAI1C,OAAOa,QAAP,CAAgBiD,OAAOpB,CAAP,CAAhB,EAA2BzD,GAA/B,EAAoC+E,EAAE/E,GAAF,CAAMe,OAAOa,QAAP,CAAgBiD,OAAOpB,CAAP,CAAhB,EAA2BzD,GAA3B,CAA+B,KAAKgB,IAApC,CAAN;AACpCuD,iBAAI7B,MAAJ,CAAWqC,CAAX;AACH;AACJ;;AAEDR,SAAI7B,MAAJ,CAAWkC,MAAX;;AAEA,SAAI7F,SAAS,MAAb,EAAqBuF,IAAInE,EAAJ,CAAO,aAAP,EAAsB,KAAK6E,aAAL,CAAmB1B,IAAnB,CAAwB,IAAxB,CAAtB;;AAErBgB,SAAI5B,MAAJ,CAAW6B,GAAX;;AAEA;AACA,UAAKzC,IAAL,GAAYwC,GAAZ;AACH;;AAED/B,WAAUH,SAAV,CAAoBuC,WAApB,GAAkC,UAAUvE,KAAV,EAAiB;AAC/CV,OAAE,cAAF,EAAkBuF,OAAlB,CAA0B,OAA1B,EAAmC,CAAC,KAAKjE,IAAL,CAAUkE,GAAX,CAAnC;AACH,EAFD;;AAIA3C,WAAUH,SAAV,CAAoB+C,mBAApB,GAA0C,UAAU/E,KAAV,EAAiB;AACvD,SAAIC,SAASX,EAAEU,MAAMC,MAAR,CAAb;AACAA,cAASC,WAAWD,MAAX,EAAmB,cAAnB,CAAT;AACA,SAAG,CAACA,MAAJ,EAAY;;AAEZ,SAAI6D,OAAO,IAAX;AACA,0CAAoB,kBAAkB,KAAKlD,IAAL,CAAUkE,GAAhD,EAAqD7E,OAAO+E,IAAP,EAArD,EAAoE,UAAUjE,GAAV,EAAe;AAC/E,aAAIA,GAAJ,EAASG,MAAOH,IAAIkE,OAAX;AACT5E,iBAAQyD,KAAKL,OAAb,EAAsBlD,aAAtB;AACH,MAHD;AAIH,EAVD;;AAYA4B,WAAUH,SAAV,CAAoBkD,WAApB,GAAkC,UAAUlF,KAAV,EAAiB;AAAA;;AAC/C,sCAAgB,kBAAhB,EAAqC,UAACe,GAAD,EAAMoE,IAAN,EAAe;AAChD,aAAIpE,GAAJ,EAASG,MAAMH,IAAIqE,MAAV;;AAET,aAAIC,QAAQ,EAAZ;AACA,cAAK,IAAIhC,IAAI,CAAb,EAAgBA,IAAI8B,KAAKT,MAAzB,EAAiCrB,GAAjC,EAAsC;AAClCgC,mBAAMF,KAAK9B,CAAL,CAAN,IAAiB,CAAC,MAAK0B,mBAAL,CAAyB7B,IAAzB,OAAD,EAAsC,MAAKoC,gBAAL,CAAsBpC,IAAtB,OAAtC,CAAjB;AACH;;AAED,aAAIqC,OAAO,IAAIC,SAAJ,CAAc,MAAK9D,IAAnB,EAAyB1B,KAAzB,EAAgCqF,KAAhC,EAAuC,IAAvC,CAAX;AACAE,cAAK7D,IAAL,CAAU4B,QAAV,CAAmB,UAAnB;AACH,MAVD;AAWH,EAZD;;AAcAnB,WAAUH,SAAV,CAAoBsD,gBAApB,GAAuC,UAAUtF,KAAV,EAAiB;AACpDV,OAAE,kCAAF,EAAsCmG,MAAtC;;AAEA,SAAIxF,SAASC,WAAWZ,EAAEU,MAAMC,MAAR,CAAX,EAA4B,cAA5B,CAAb;AACA,SAAI,CAACA,MAAL,EAAa;;AAEb,UAAKyF,aAAL,GAAqBzF,OAAO+E,IAAP,EAArB;;AAEA,SAAIO,OAAO,IAAIC,SAAJ,CAAc,KAAK9D,IAAnB,EAAyB1B,KAAzB,EAAgC;AACvC,uBAAc,CAAC,KAAK2F,SAAL,CAAezC,IAAf,CAAoB,IAApB,CAAD,CADyB;AAEvC,oBAAW,CAAC,KAAK0C,WAAL,CAAiB1C,IAAjB,CAAsB,IAAtB,CAAD;AAF4B,MAAhC,CAAX;AAIH,EAZD;;AAcAf,WAAUH,SAAV,CAAoB4C,aAApB,GAAoC,UAAU5E,KAAV,EAAiB;AACjD,SAAIC,SAASC,WAAWZ,EAAEU,MAAMC,MAAR,CAAX,EAA4B,mDAA5B,CAAb;AACA,SAAI,CAACA,MAAL,EAAa;AACTX,WAAE,aAAF,EAAiBmG,MAAjB;AACA;AACH;;AAED,SAAI,CAACxF,OAAO4F,QAAP,CAAgB,YAAhB,CAAL,EAAoCvG,EAAE,aAAF,EAAiBmG,MAAjB;;AAEpC,SAAIxF,OAAO4F,QAAP,CAAgB,WAAhB,CAAJ,EAAkC;AAC9B,aAAIC,YAAY,IAAIN,SAAJ,CAAc,KAAK9D,IAAnB,EAAyB1B,KAAzB,EAAgC;AAC5C,8BAAiB,CAAC,KAAK+F,MAAL,CAAY7C,IAAZ,CAAiB,IAAjB,CAAD;AAD2B,UAAhC,CAAhB;AAGH,MAJD,MAIO,IAAIjD,OAAO4F,QAAP,CAAgB,eAAhB,CAAJ,EAAsC;AACzC,aAAIC,YAAY,IAAIN,SAAJ,CAAc,KAAK9D,IAAnB,EAAyB1B,KAAzB,EAAgC;AAC5C,4CAA+B,CAAC,KAAKuE,WAAL,CAAiBrB,IAAjB,CAAsB,IAAtB,CAAD,CADa;AAE5C,+CAAkC,CAAC,KAAKgC,WAAL,CAAiBhC,IAAjB,CAAsB,IAAtB,CAAD;AAFU,UAAhC,CAAhB;AAIH,MALM,MAKA,IAAIjD,OAAO4F,QAAP,CAAgB,gBAAhB,CAAJ,EAAuC;AAC1C;AACH;;AAED7F,WAAMG,cAAN;AACH,EAvBD;;AAyBAgC,WAAUH,SAAV,CAAoB2D,SAApB,GAAgC,UAAU3F,KAAV,EAAiB;AAC7CV,OAAE,gBAAF,EAAoBmG,MAApB;AACA,SAAIO,aAAa1G,EAAE,WAAF,CAAjB;;AAEA,UAAK2G,MAAL,GAAc3G,EAAE,4CAA4C,KAAKoG,aAAjD,GAAiE,4BAAnE,CAAd;AACA,UAAKO,MAAL,CAAYC,QAAZ,CAAqBF,WAAWxC,MAAX,EAArB;AACA,UAAKyC,MAAL,CAAYrG,GAAZ,CAAgB;AACZuG,mBAAU,UADE;AAEZC,cAAKJ,WAAWG,QAAX,GAAsBC,GAAtB,GAA4B,IAFrB;AAGZC,eAAML,WAAWG,QAAX,GAAsBE,IAAtB,GAA6BL,WAAWhD,KAAX,EAA7B,GAAkD,IAH5C;AAIZsD,qBAAY,MAJA;AAKZC,iBAAQ;AALI,MAAhB;;AAQA,UAAKN,MAAL,CAAYlG,EAAZ,CAAe,MAAf,EAAwB,YAAY;AAChC,aAAI2D,MAAM,KAAKuC,MAAL,CAAYO,QAAZ,GAAuBC,IAAvB,CAA4B,KAA5B,CAAV;AACA,aAAK/C,IAAIV,KAAJ,KAAcU,IAAI7D,MAAJ,EAAf,IAAgC6D,IAAIV,KAAJ,KAAc,KAAKiD,MAAL,CAAYjD,KAAZ,EAAlD,EAAuE;AACnE1D,eAAEoE,GAAF,EAAO9D,GAAP,CAAW;AACPoD,wBAAO;AADA,cAAX;AAGH,UAJD,MAIO,IAAIU,IAAI7D,MAAJ,KAAe,KAAKoG,MAAL,CAAYpG,MAAZ,EAAnB,EAAyC;AAC5CP,eAAEoE,GAAF,EAAO9D,GAAP,CAAW;AACPC,yBAAQ;AADD,cAAX;AAGH;AACJ,MAXsB,CAWpBqD,IAXoB,CAWf,IAXe,CAAvB;AAYH,EA1BD;;AA4BAf,WAAUH,SAAV,CAAoB4D,WAApB,GAAkC,UAAU5F,KAAV,EAAiB;AAC/C,4CAAsB,8BAA8B,KAAK0F,aAAzD,EAAwE,UAAU3E,GAAV,EAAe;AACnF,aAAIA,GAAJ,EAASG,MAAMH,IAAIkE,OAAV;AACT5E,iBAAQO,KAAKJ,GAAb,EAAkBD,aAAlB;AACH,MAHD;AAIH,EALD;;AAOA4B,WAAUH,SAAV,CAAoB+D,MAApB,GAA6B,UAAU/F,KAAV,EAAiB;AAC1C,SAAI8D,OAAO,IAAX;AACA,uCAAiB,4BAA4B,KAAKlD,IAAL,CAAUkE,GAAvD,EAA4D,UAAU/D,GAAV,EAAe;AACvE,aAAIA,GAAJ,EAASG,MAAOH,IAAIkE,OAAX;AACT5E,iBAAQyD,KAAKL,OAAb,EAAsBlD,aAAtB;AACH,MAHD;AAIH,EAND;;AAQA;AACA,UAASmG,UAAT,CAAoBlD,MAApB,EAA4B;AACxB,UAAKA,MAAL,GAAcA,MAAd;;AAEA,UAAK9B,IAAL,GAAYpC,EAAE,sEAAF,CAAZ;AACA;AACA,UAAKoC,IAAL,CAAUwE,QAAV,CAAmB5G,EAAE,eAAF,CAAnB;;AAEA,UAAKoC,IAAL,CAAU9B,GAAV,CAAc;AACV+G,gBAAO,OADG;AAEVC,iBAAQ;AACR;;;AAHU,MAAd;;AAQAtH,OAAE,KAAKoC,IAAP,EAAa3B,EAAb,CAAgB,OAAhB,EAAyB,KAAK8G,UAAL,CAAgB3D,IAAhB,CAAqB,IAArB,CAAzB;AACH;;AAEDwD,YAAW1E,SAAX,CAAqB6E,UAArB,GAAkC,YAAY;AAC1C,SAAIlI,SAAS,MAAb,EAAqB;AACjBA,gBAAO,MAAP;AACA,cAAK+C,IAAL,CAAUsD,IAAV,CAAe,UAAf;AACA;AACA,aAAI,CAAC1F,EAAE,cAAF,EAAkBoF,MAAvB,EAA+B,KAAKoC,iBAAL;AAClC,MALD,MAKO;AACHnI,gBAAO,MAAP;AACA,cAAK+C,IAAL,CAAUsD,IAAV,CAAe,eAAf;AACH;;AAEDzE;;AAEA,UAAKiD,MAAL,CAAYuD,MAAZ;AACH,EAdD;;AAgBAL,YAAW1E,SAAX,CAAqB8E,iBAArB,GAAyC,YAAY;AACjD,SAAIE,cAAc1H,EAAE,qBAAF,CAAlB;AACA0H,iBAAY1G,IAAZ,CAAiB,IAAjB,EAAuB,aAAvB;AACA0G,iBAAYpH,GAAZ,CAAgB;AACZoD,gBAAO,GADK;AAEZnD,iBAAQ,GAFI;AAGZoH,iBAAQ,GAHI;AAIZC,kBAAS;AAJG,MAAhB;AAMA5H,OAAEC,SAASI,IAAX,EAAiB2C,MAAjB,CAAwB0E,WAAxB;;AAEA,SAAIG,QAAJ;;AAEAH,iBAAYjH,EAAZ,CAAe,OAAf,EAAwB,UAACC,KAAD,EAAQoH,EAAR,EAAe;AACnCD,oBAAWC,EAAX;AACH,MAFD;;AAIAJ,iBAAYjH,EAAZ,CAAe,QAAf,EAAyB,UAAUC,KAAV,EAAiB;AACtC,8CAAoB,kBAAkBmH,QAAtC,EAAgD,KAAK9B,KAAL,CAAW,CAAX,CAAhD,EAA+D,UAAUtE,GAAV,EAAe;AAC1E,iBAAIA,GAAJ,EAASG,MAAOH,IAAIkE,OAAX;AACT5E,qBAAQxB,WAAW2B,GAAnB,EAAwBD,aAAxB,EAF0E,CAEnC;AAC1C,UAHD;AAIH,MALD;AAMH,EAvBD;;AAyBA;AACA,UAASb,SAAT,GAAsB;AAClB,SAAIJ,EAAE,eAAF,EAAmBgB,IAAnB,CAAwB,YAAxB,MAA0C,MAA9C,EAAsD,KAAK+G,MAAL,GAAc,IAAIX,UAAJ,CAAe,IAAf,CAAd;;AAEtD,UAAKhF,IAAL,GAAYpC,EAAE,aAAF,CAAZ;AACA,UAAKoC,IAAL,CAAU3B,EAAV,CAAa,OAAb,EAAsB,cAAtB,EAAsC,KAAKuH,WAAL,CAAiBpE,IAAjB,CAAsB,IAAtB,CAAtC;AACH;;AAEDxD,WAAUsC,SAAV,CAAoBsF,WAApB,GAAkC,UAAUtH,KAAV,EAAiB;AAC/C,SAAIC,SAASC,WAAWZ,EAAEU,MAAMC,MAAR,CAAX,EAA4B,aAA5B,CAAb;AACA,aAAQA,OAAOK,IAAP,CAAY,IAAZ,CAAR;AACI,cAAK,eAAL;AACI,kBAAKiH,YAAL;AACA;AACJ,cAAK,cAAL;AACI,kBAAKC,WAAL;AACA;AANR,MAOC;AACJ,EAVD;;AAYA9H,WAAUsC,SAAV,CAAoB+E,MAApB,GAA6B,YAAY;AACrC,SAAI,KAAKrF,IAAL,CAAUpB,IAAV,CAAe,QAAf,CAAJ,EAA8B,KAAKoB,IAAL,CAAU+F,UAAV,CAAqB,QAArB,EAA9B,KACK,KAAK/F,IAAL,CAAUpB,IAAV,CAAe,QAAf,EAAyB,MAAzB;AACR,EAHD;;AAKAZ,WAAUsC,SAAV,CAAoBuF,YAApB,GAAmC,YAAY;AAC3C,SAAIG,gBAAgB,mBAAY;AAC5B,sBAAa,MADe;AAE5B,qBAAY;AAFgB,MAAZ,EAGjB,WAHiB,CAApB;;AAKAA,mBAAcpG,MAAd;AACH,EAPD;;AASA5B,WAAUsC,SAAV,CAAoBwF,WAApB,GAAkC,YAAY;AAC1C,SAAIG,SAAS,mBAAW,EAAC,aAAa,EAAd,EAAX,EAA8B,UAA9B,EAA0C,UAAUC,IAAV,EAAgB;AACnE,aAAIC,WAAWD,KAAKE,cAAL,EAAf;AACA,gBAAO;AACHC,mBAAMF,SAAS,CAAT,EAAYG,KADf;AAEHxH,kBAAK,kDAAkDqH,SAAS,CAAT,EAAYG,KAFhE;AAGH7B,uBAAU7G,EAAE,cAAF,EAAkBoF;AAHzB,UAAP;AAKH,MAPY,EAOV,UAAU3D,GAAV,EAAeH,IAAf,EAAqB;AACpB,aAAIG,GAAJ,EAAS;AACL,iBAAIA,IAAIkE,OAAJ,KAAgB,yBAApB,EAA+C/D,MAAM,gDAAN,EAA/C,KACKA,MAAMH,IAAIkE,OAAV;AACL;AACH;;AAED3F,WAAE,YAAF,EAAgBgD,MAAhB,CAAuB;;+CAAA,GAEkB1B,KAAKJ,GAFvB,GAE6B,IAF7B,GAEoCI,KAAKmH,IAFzC,GAEgD;;UAFvE;AAKH,MAnBY,CAAb;AAoBAJ,YAAOrG,MAAP;AACH,EAtBD;;AAwBA;AACA,UAASkE,SAAT,CAAmBhC,MAAnB,EAA2ByE,aAA3B,EAA0CC,KAA1C,EAAiDC,WAAjD,EAA8D;AAAE;AAC5D,UAAK3E,MAAL,GAAcA,MAAd;AACA,UAAK9B,IAAL,GAAYpC,EAAE,6BAA6B6I,cAAc,oBAAd,GAAqC,qBAAlE,IAA2F,SAA7F,CAAZ;AACA,UAAKhD,IAAL,GAAY7F,EAAE,8BAAF,CAAZ;;AAEA,UAAK,IAAI8I,IAAT,IAAiBF,KAAjB,EAAwB;AACpB,cAAKG,QAAL,CAAcD,IAAd,EAAoBF,MAAME,IAAN,IAAcF,MAAME,IAAN,EAAY,CAAZ,CAAd,GAA+B,IAAnD,EAAyDF,MAAME,IAAN,IAAcF,MAAME,IAAN,EAAY,CAAZ,CAAd,GAA+B,IAAxF;AACH;;AAED,UAAK1G,IAAL,CAAUY,MAAV,CAAiB,KAAK6C,IAAtB;;AAEA,UAAK7D,MAAL,CAAY2G,aAAZ;AACH;;AAEDzC,WAAUxD,SAAV,CAAoBqG,QAApB,GAA+B,UAAUC,QAAV,EAAoBC,OAApB,EAA6BC,aAA7B,EAA4C;AACvE,SAAIJ,OAAO9I,EAAE,kDAAkDgJ,QAAlD,GAA6D,OAA/D,CAAX;;AAEA,UAAKnD,IAAL,CAAU7C,MAAV,CAAiB8F,IAAjB;;AAEAA,UAAKrI,EAAL,CAAQ,OAAR,EAAkB,UAAUC,KAAV,EAAiB;AAC/B,aAAIuI,OAAJ,EAAaA,QAAQvI,KAAR;AACbA,eAAMG,cAAN;AACA,cAAKsI,KAAL;AACH,MAJgB,CAIdvF,IAJc,CAIT,IAJS,CAAjB;;AAMAkF,UAAKrI,EAAL,CAAQ,aAAR,EAAwB,UAAUC,KAAV,EAAiB;AACrC,aAAIwI,aAAJ,EAAmBA,cAAcxI,KAAd;AACnBA,eAAMG,cAAN;AACH,MAHsB,CAGpB+C,IAHoB,CAGf,IAHe,CAAvB;AAIH,EAfD;;AAiBAsC,WAAUxD,SAAV,CAAoBV,MAApB,GAA6B,UAAU2G,aAAV,EAAyB;AAClD,SAAIS,SAAS,KAAKlF,MAAL,CAAYkF,MAAZ,EAAb;AACA,UAAKlF,MAAL,CAAYlB,MAAZ,CAAmB,KAAKZ,IAAxB;AACA,UAAKA,IAAL,CAAU9B,GAAV,CAAc;AACVuG,mBAAU,UADA;AAEVE,eAAM4B,gBAAiBA,cAAcU,OAAd,GAAwBD,OAAOrC,IAA/B,GAAsC/G,EAAEJ,MAAF,EAAU0J,UAAV,EAAtC,GAA+D,IAAhF,GACD,CAAC1J,OAAO2J,WAAP,IAAsBtJ,SAASuJ,eAAT,CAAyBF,UAAhD,IAA+DrJ,SAASuJ,eAAT,CAAyBC,WAAzB,GAAqC,CAApG,GAA0G,KAAKrH,IAAL,CAAUsH,GAAV,CAAc,CAAd,EAAiBC,WAAjB,GAA6B,CAAvI,GAA4IP,OAAOrC,IAAnJ,GAA0J,IAHrJ;AAIVD,cAAK6B,gBAAiBA,cAAciB,OAAd,GAAwBR,OAAOtC,GAA/B,GAAqC9G,EAAEJ,MAAF,EAAUiK,SAAV,EAArC,GAA6D,IAA9E,GAAsF,KAJjF;AAKV5C,iBAAQ;AALE,MAAd;AAOH,EAVD;;AAYAf,WAAUxD,SAAV,CAAoByG,KAApB,GAA4B,YAAY;AACpC,UAAK/G,IAAL,CAAU0H,MAAV;AACH,EAFD;;SAIQtK,Y,GAAAA,Y;SAAcD,U,GAAAA,U;SAAYG,M,GAAAA,M;SAAQiC,W,GAAAA,W;SAAarC,U,GAAAA,U;SAAYwC,U,GAAAA,U;;;;;;AClmBnE;;;;;mBAMwBiI,gB;;AAJxB;;AACA;;AACA;;AAEe,UAASA,gBAAT,GAA6B;;AAExC/J,OAAEC,QAAF,EAAYC,KAAZ,CAAkB,YAAY;AAC1BF,WAAE,kBAAF,EAAsBS,EAAtB,CAAyB,OAAzB,EAAkC,UAAUC,KAAV,EAAiB;AAC/CA,mBAAMG,cAAN;;AAEA,iBAAIF,SAAS,4BAAWX,EAAEU,MAAMC,MAAR,CAAX,EAA4B,eAA5B,CAAb;AACA,iBAAI,CAACA,MAAL,EAAa;;AAEbqJ,4BAAerJ,OAAOK,IAAP,CAAY,IAAZ,CAAf;AACH,UAPD;;AASAhB,WAAE,UAAF,EAAcS,EAAd,CAAiB,OAAjB,EAA0B,UAAUC,KAAV,EAAiB;AACvCA,mBAAMG,cAAN;;AAEA,iBAAIF,SAAS,4BAAWX,EAAEU,MAAMC,MAAR,CAAX,EAA4B,SAA5B,CAAb;AACA,iBAAI,CAACA,MAAL,EAAa;;AAEb,uDAAyB,UAAzB,EAAqC,IAArC,EAA2C,UAAUc,GAAV,EAAe;AACtD,qBAAIA,GAAJ,EAASG,MAAOH,IAAIkE,OAAX,EAAT,KACK/F,OAAOC,QAAP,CAAgBoK,IAAhB,GAAuB,GAAvB;AACR,cAHD;AAIH,UAVD;;AAYA;AACAjK,WAAEC,SAASuJ,eAAX,EAA4B/I,EAA5B,CAA+B,eAA/B,EAAgD,UAAUC,KAAV,EAAiB;AAC7D,iBAAIA,MAAMwJ,OAAN,IAAiBxJ,MAAMwJ,OAAN,KAAkB,EAAvC,EAA2C;;AAE3C,iBAAI,4BAAWlK,EAAEU,MAAMC,MAAR,CAAX,EAA4B,KAA5B,CAAJ,EAAwC;;AAExC;AACA,iBAAG,CAAC,4BAAWX,EAAEU,MAAMC,MAAR,CAAX,EAA4B,cAA5B,CAAD,IAAgDD,MAAMwJ,OAAN,KAAkB,EAArE,EAAyE;AACrElK,mBAAE,gBAAF,EAAoBmG,MAApB;AACAnG,mBAAE,aAAF,EAAiB8J,MAAjB;AACH;;AAED;AACA,iBAAG,CAAC,4BAAW9J,EAAEU,MAAMC,MAAR,CAAX,EAA4B,oDAA5B,CAAD,IAAsFD,MAAMwJ,OAAN,KAAkB,EAA3G,EAA+G;AAC3G,qCAAYxH,SAAZ,CAAsByG,KAAtB;AACH;AACJ,UAfD;AAgBH,MAvCD;;AAyCA,cAASa,cAAT,CAAwBlC,EAAxB,EAA4B;AACxB,aAAIqC,aAAa,uBAAerC,EAAf,CAAjB;AACAqC,oBAAWnI,MAAX;AACH;AACJ,G;;;;;;ACrDD;;;;;;;AAEA;;AACA;;AAEA;AACA,UAASoI,OAAT,CAAkBlG,MAAlB,EAA0B;AACtB,SAAI,CAACA,OAAO5C,IAAZ,EAAkB;;AAElB+I,iBAAYC,IAAZ,CAAiB,IAAjB,EAAuB,KAAvB;;AAEA,UAAKpG,MAAL,GAAcA,MAAd;;AAEA,UAAK9B,IAAL,CAAUpB,IAAV,CAAe,IAAf,EAAqB,SAArB;AACA,UAAKoB,IAAL,CAAU9B,GAAV,CAAc;AACV0G,qBAAY,MADF;AAEVY,kBAAS;AAFC,MAAd;AAIH;;AAEDwC,SAAQ1H,SAAR,GAAoB6H,OAAOC,MAAP,CAAcH,YAAY3H,SAA1B,CAApB;AACA0H,SAAQ1H,SAAR,CAAkB+H,WAAlB,GAAgCL,OAAhC;;AAEAA,SAAQ1H,SAAR,CAAkBV,MAAlB,GAA2B,YAAY;AACnC,SAAIwC,OAAO,IAAX;;AAEA,SAAI,CAAC,KAAKpC,IAAL,CAAUkB,IAAV,EAAL,EAAuB;AACnB,cAAKoH,OAAL,GAAe1K,EAAE,eAAF,CAAf;;AAEA,cAAKiB,aAAL;;AAEA,aAAI5B,SAAS,MAAb,EAAqB;AACjB,iBAAIsL,aAAa3K,EAAE,mFAAF,CAAjB;AACA2K,wBAAWrK,GAAX,CAAe;AACX+G,wBAAO;AADI,cAAf;;AAIA,iBAAIuD,YAAY5K,EAAE,iFAAF,CAAhB;;AAEA,iBAAI6K,eAAe7K,EAAE,kFAAF,CAAnB;AACA6K,0BAAavK,GAAb,CAAiB;AACb+G,wBAAO;AADM,cAAjB;;AAIA,kBAAKqD,OAAL,CAAa1H,MAAb,CAAoB6H,YAApB;AACA,kBAAKH,OAAL,CAAa1H,MAAb,CAAoB4H,SAApB;AACA,kBAAKF,OAAL,CAAa1H,MAAb,CAAoB2H,UAApB;AACH;AACJ;;AAED,UAAKD,OAAL,CAAajK,EAAb,CAAgB,QAAhB,EAA0B,KAAKW,MAAL,CAAYwC,IAAZ,CAAiB,IAAjB,CAA1B;AACA,UAAK8G,OAAL,CAAajK,EAAb,CAAgB,OAAhB,EAAyB,MAAzB,EAAiC,KAAKqK,eAAL,CAAqBlH,IAArB,CAA0B,IAA1B,CAAjC;;AAEA,UAAKmH,OAAL,CAAa,KAAKL,OAAlB;AACH,EA/BD;;AAiCAN,SAAQ1H,SAAR,CAAkBzB,aAAlB,GAAkC,YAAY;AAC1C,UAAKmB,IAAL,CAAU+E,IAAV,CAAe,mBAAf,EAAoChB,MAApC;;AAEA,SAAI6E,QAAQhL,EAAE,+DAAF,CAAZ;AACA,UAAKiL,KAAL,GAAajL,EAAE,8CAAF,CAAb;;AAEA;AACA,SAAI4I,QAAQ,oCAAmB,KAAK1E,MAAL,CAAY5C,IAAZ,CAAiBgD,KAApC,CAAZ;;AAEA,UAAK,IAAIP,IAAI6E,MAAMxD,MAAN,GAAe,CAA5B,EAA+BrB,KAAK,CAApC,EAAuCA,GAAvC,EAA4C;AACxC,cAAKgF,QAAL,CAAc,KAAKkC,KAAL,CAAW9D,IAAX,CAAgB,OAAhB,CAAd,EAAwC,EAAC+D,KAAKtC,MAAM7E,CAAN,CAAN,EAAgBoH,KAAK,KAAKjH,MAAL,CAAY5C,IAAZ,CAAiBgD,KAAjB,CAAuBsE,MAAM7E,CAAN,CAAvB,CAArB,EAAxC;AACH;;AAEDiH,WAAMhI,MAAN,CAAa,KAAKiI,KAAlB;AACA,UAAKP,OAAL,CAAaU,OAAb,CAAqBJ,KAArB;AACH,EAfD;;AAiBAZ,SAAQ1H,SAAR,CAAkBoI,eAAlB,GAAoC,UAAUpK,KAAV,EAAiB;AACjD,SAAIC,SAASX,EAAEU,MAAMC,MAAR,CAAb;AACAA,cAAS,4BAAWA,MAAX,EAAmB,KAAnB,CAAT;AACA,SAAI,CAACA,MAAL,EAAa;;AAEb,aAAQA,OAAOK,IAAP,CAAY,IAAZ,CAAR;AACI,cAAK,YAAL;AACI,kBAAK+H,QAAL,CAAc,KAAKkC,KAAL,CAAW9D,IAAX,CAAgB,OAAhB,CAAd;AACA;AACJ,cAAK,WAAL;AACI,kBAAKkE,WAAL,CAAiB,KAAKJ,KAAL,CAAW9D,IAAX,CAAgB,OAAhB,CAAjB,EAA2CxG,OAAOK,IAAP,CAAY,KAAZ,CAA3C;AACA;AACJ,cAAK,eAAL;AACI,kBAAKC,aAAL;AACA,kBAAKkI,KAAL;AACA;AAVR,MAWC;;AAEDxI,YAAO2K,IAAP;AACH,EAnBD;;AAqBAlB,SAAQ1H,SAAR,CAAkBqG,QAAlB,GAA6B,UAAUwC,SAAV,EAAqB7C,KAArB,EAA4B;AACrD,SAAIrJ,SAAS,MAAb,EAAqB;AACjBkM,mBAAUvI,MAAV,CACI;+CAAA,IACsC0F,QAAQA,MAAMwC,GAAd,GAAoB,EAD1D,IACgE;+CADhE,IAEsCxC,QAAQA,MAAMyC,GAAd,GAAoB,EAF1D,IAE+D;2EAF/D,GAGiEI,UAAUC,QAAV,GAAqBpG,MAHtF,GAG+F;mBAJnG;AAMH,MAPD,MAOO;AACHmG,mBAAUvI,MAAV,CACI;sBAAA,IACa0F,QAAQA,MAAMwC,GAAd,GAAoB,EADjC,IACuC;sBADvC,IAEaxC,QAAQA,MAAMyC,GAAd,GAAoB,EAFjC,IAEuC;mBAH3C;AAKH;AACJ,EAfD;;AAiBAf,SAAQ1H,SAAR,CAAkB2I,WAAlB,GAAgC,UAAUE,SAAV,EAAqBE,GAArB,EAA0B;AACtDF,eAAUC,QAAV,GAAqBE,EAArB,CAAwB,CAACD,GAAzB,EAA8BtF,MAA9B;;AAEA,UAAK,IAAIpC,IAAI,CAAC0H,GAAd,EAAmB1H,IAAIwH,UAAUC,QAAV,GAAqBpG,MAA5C,EAAoDrB,GAApD,EAAyD;AACrDwH,mBAAUC,QAAV,GAAqBE,EAArB,CAAwB3H,CAAxB,EAA2BoD,IAA3B,CAAgC,OAAhC,EAAyCnG,IAAzC,CAA8C,KAA9C,EAAqD+C,CAArD;AACH;AACJ,EAND;;AAQAqG,SAAQ1H,SAAR,CAAkBtB,MAAlB,GAA2B,UAAUV,KAAV,EAAiB;AACxC,SAAI4H,OAAOtI,EAAEU,MAAMC,MAAR,CAAX;;AAEA,SAAI6D,OAAO,IAAX;AACA,wCAAkB,6BAA6B,KAAKN,MAAL,CAAY5C,IAAZ,CAAiBkE,GAAhE,EAAqE8C,KAAKE,cAAL,EAArE,EAA4F,UAAU/G,GAAV,EAAe;AACvG,aAAIA,GAAJ,EAASG,MAAOH,IAAIkE,OAAX;AACT5E,iBAAQyD,KAAKN,MAAL,CAAYC,OAApB,EAA6BlD,aAA7B;AACH,MAHD;;AAKA,UAAKkI,KAAL;;AAEAzI,WAAMG,cAAN;AACH,EAZD;;AAcA;AACA;AACA;AACA,UAAS8K,MAAT,CAAiB/C,KAAjB,EAAwBgD,EAAxB,EAA4BC,UAA5B,EAAwC1K,QAAxC,EAAkD;AAC9C,SAAI2K,aAAa;AACbxK,eAAM;AACFkE,kBAAK,IADH;AAEFlB,oBAAOsE;AAFL;AADO,MAAjB;;AAOAwB,aAAQE,IAAR,CAAa,IAAb,EAAmBwB,UAAnB;;AAEA,UAAKF,EAAL,GAAUA,EAAV;AACA,UAAKC,UAAL,GAAkBA,UAAlB;AACA,UAAK1K,QAAL,GAAgBA,QAAhB;AACH;;AAEDwK,QAAOjJ,SAAP,GAAmB6H,OAAOC,MAAP,CAAcJ,QAAQ1H,SAAtB,CAAnB;AACAiJ,QAAOjJ,SAAP,CAAiB+H,WAAjB,GAA+BkB,MAA/B;;AAEAA,QAAOjJ,SAAP,CAAiBtB,MAAjB,GAA0B,UAAUV,KAAV,EAAiB;AACvC,SAAI8D,OAAO,IAAX;AACA,SAAI8D,OAAOtI,EAAEU,MAAMC,MAAR,CAAX;;AAEA,SAAI,KAAKkL,UAAT,EAAqB,IAAItD,WAAW,KAAKsD,UAAL,CAAgBvD,IAAhB,CAAf,CAArB,KACK,IAAIC,WAAWD,KAAKE,cAAL,EAAf;;AAEL,SAAI,CAACD,SAASrH,GAAV,IAAiB3B,UAArB,EAAiCgJ,SAASrH,GAAT,GAAe3B,WAAW2B,GAA1B;AACjC,wCAAkB,gBAAgB,KAAK0K,EAArB,GAA0B,MAA1B,GAAmC,KAAK1H,MAAL,CAAY5C,IAAZ,CAAiBkE,GAAtE,EAA2E+C,QAA3E,EAAqF,UAAU9G,GAAV,EAAe;AAChG,aAAIA,GAAJ,EAAS;AACL,iBAAI+C,KAAKrD,QAAT,EAAmBqD,KAAKrD,QAAL,CAAcM,GAAd,EAAnB,KACKG,MAAOH,IAAIkE,OAAX;AACL;AACH;;AAED,aAAI4C,QAAJ,EAAc;AACVxH,qBAAQwH,SAASrH,GAAjB,EAAsB,YAAY;AAC9BD;AACA,qBAAIuD,KAAKrD,QAAT,EAAmBqD,KAAKrD,QAAL,CAAc,IAAd,EAAoBoH,QAApB;;AAEnB,qBAAI/D,KAAKoH,EAAL,KAAY,UAAhB,EAA4B;AACxB9K,oCAAed,EAAE,wBAAwBuI,SAASrH,GAAjC,GAAuC,IAAzC,CAAf;AACH;AACJ,cAPD;AAQH;AACJ,MAjBD;;AAmBA,UAAKiI,KAAL;;AAEAzI,WAAMG,cAAN;AACH,EA9BD;;AAgCA;AACA,UAASkL,UAAT,CAAqBC,IAArB,EAA2B;AACvB3B,iBAAYC,IAAZ,CAAiB,IAAjB,EAAuB,IAAvB;;AAEA,UAAKlI,IAAL,CAAUpB,IAAV,CAAe,IAAf,EAAqB,kBAArB;AACA,UAAKoB,IAAL,CAAU9B,GAAV,CAAc;AACV0G,qBAAY,MADF;AAEVY,kBAAS,KAFC;AAGVD,iBAAQ,gBAHE;AAIVsE,uBAAc;AAJJ,MAAd;;AAOA,UAAKD,IAAL,GAAYA,IAAZ;AACH;;AAEDD,YAAWrJ,SAAX,GAAuB6H,OAAOC,MAAP,CAAcH,YAAY3H,SAA1B,CAAvB;AACAqJ,YAAWrJ,SAAX,CAAqB+H,WAArB,GAAmCsB,UAAnC;;AAEAA,YAAWrJ,SAAX,CAAqBV,MAArB,GAA8B,YAAY;AACtC,UAAKsG,IAAL,GAAYtI,EACZ;;;;;;;;;aADY,CAAZ;;AAYA,UAAKsI,IAAL,CAAUhI,GAAV,CAAc;AACV4L,mBAAU;AADA,MAAd;;AAIA,SAAIhH,SAASlF,EAAE,qEAAsE,KAAKgM,IAAL,KAAc,QAAf,GAA2B,OAA3B,GAAsC,KAAKA,IAAL,KAAc,QAAf,GAA2B,aAA3B,GAA2C,EAArJ,IAA2J,WAA7J,CAAb;AACA9G,YAAO5E,GAAP,CAAW;AACPgH,iBAAQ,kBADD;AAEPD,gBAAO;AAFA,MAAX;AAIA,UAAKiB,IAAL,CAAUtF,MAAV,CAAiBkC,MAAjB;;AAEA,UAAKoD,IAAL,CAAU7H,EAAV,CAAa,QAAb,EAAuB,KAAKW,MAAL,CAAYwC,IAAZ,CAAiB,IAAjB,CAAvB;;AAEA,UAAKmH,OAAL,CAAa,KAAKzC,IAAlB;AACH,EA3BD;;AA6BAyD,YAAWrJ,SAAX,CAAqBtB,MAArB,GAA8B,UAAUV,KAAV,EAAiB;AAC3C,+CAAyB,MAAM,KAAKsL,IAApC,EAA0C,KAAK1D,IAA/C,EAAqD,UAAU7G,GAAV,EAAe;AAChE,aAAIA,GAAJ,EAASG,MAAOH,IAAIkE,OAAX,EAAT,KACK;AACD0E,yBAAY3H,SAAZ,CAAsByG,KAAtB;AACAtJ,sBAASsM,MAAT;AACH;AACJ,MAND;;AAQAzL,WAAMG,cAAN;AACH,EAVD;;AAYA;AACA;AACA,UAASwJ,WAAT,GAAwB;AACpB,UAAKjI,IAAL,GAAYpC,EAAE,yBAAF,CAAZ;AACA,UAAKoC,IAAL,CAAU9B,GAAV,CAAc;AACV2G,iBAAQ;AADE,MAAd;;AAIA,UAAKzE,aAAL,GAAqB,KAArB;AACH;;AAED6H,aAAY3H,SAAZ,CAAsBqI,OAAtB,GAAgC,UAAUL,OAAV,EAAmB;AAC/C,UAAKvB,KAAL;;AAEA,UAAKiD,gBAAL,CAAsB,IAAtB;;AAEA,SAAI,CAAC,KAAKhK,IAAL,CAAUkB,IAAV,EAAL,EAAuB;AACnB,aAAIoH,OAAJ,EAAa,KAAKtI,IAAL,CAAUY,MAAV,CAAiB0H,OAAjB;;AAEb,cAAK2B,WAAL,GAAmBrM,EAAE,aAAF,CAAnB;AACA,cAAKqM,WAAL,CAAiB/L,GAAjB,CAAqB;AACjBoD,oBAAO,MADU;AAEjBnD,qBAAQ,MAFS;AAGjB8G,oBAAO;AAHU,UAArB;AAKA,aAAIiF,WAAWtM,EAAE,mCAAF,CAAf;AACAsM,kBAAShM,GAAT,CAAa;AACToD,oBAAO,MADE;AAETnD,qBAAQ;AAFC,UAAb;AAIA,cAAK8L,WAAL,CAAiBrJ,MAAjB,CAAwBsJ,QAAxB;AACA,cAAKD,WAAL,CAAiBtH,KAAjB,CAAuB,YAAY;AAC/B/E,eAAE,IAAF,EAAQM,GAAR,CAAY;AACR0E,yBAAQ;AADA,cAAZ;AAGH,UAJD;;AAMA,aAAIuH,WAAYvM,EAAE,8BAAF,CAAhB;;AAEA,cAAKoC,IAAL,CAAUgJ,OAAV,CAAkB,KAAKiB,WAAvB;AACAE,kBAASC,WAAT,CAAqB,KAAKH,WAA1B;;AAEA,cAAKjK,IAAL,CAAU9B,GAAV,CAAc;AACVuG,uBAAU;AADA,UAAd;AAGH;;AAED,UAAKzE,IAAL,CAAU9B,GAAV,CAAc;AACVmM,qBAAY,QADF,CACW;AADX,MAAd;AAGAzM,OAAEC,SAASI,IAAX,EAAiB2C,MAAjB,CAAwB,KAAKZ,IAA7B;;AAEA,UAAKiK,WAAL,CAAiB5L,EAAjB,CAAoB,OAApB,EAA6B,KAAK0I,KAAL,CAAWvF,IAAX,CAAgB,IAAhB,CAA7B;;AAEA5D,OAAEJ,MAAF,EAAUa,EAAV,CAAa,QAAb,EAAuB,KAAKoG,QAAL,CAAcjD,IAAd,CAAmB,IAAnB,CAAvB;;AAEA;AACA;AACA5D,OAAEC,QAAF,EAAYQ,EAAZ,CAAe,OAAf,EAAwB,YAAY;AAChC,aAAI,KAAK+B,aAAT,EAAwB;;AAExB,cAAKA,aAAL,GAAqB,IAArB;;AAEAxC,WAAEJ,MAAF,EAAUqE,GAAV,CAAc,QAAd,EAAwB,KAAK4C,QAAL,CAAcjD,IAAd,CAAmB,IAAnB,CAAxB,EALgC,CAKmB;AACnD5D,WAAEJ,MAAF,EAAUa,EAAV,CAAa,QAAb,EAAuB,KAAKoG,QAAL,CAAcjD,IAAd,CAAmB,IAAnB,CAAvB,EANgC,CAMkB;AACrD,MAPuB,CAOtBA,IAPsB,CAOjB,IAPiB,CAAxB;;AASA;AACA5D,OAAEC,QAAF,EAAYQ,EAAZ,CAAe,OAAf,EAAwB,UAAUC,KAAV,EAAiB;AACrC,aAAIV,EAAEU,MAAMC,MAAR,EAAgBK,IAAhB,CAAqB,MAArB,CAAJ,EAAkC,KAAKwB,aAAL,GAAqB,KAArB;AAClCxC,WAAEJ,MAAF,EAAUqE,GAAV,CAAc,QAAd,EAAwB,KAAK4C,QAAL,CAAcjD,IAAd,CAAmB,IAAnB,CAAxB,EAFqC,CAEc;AACnD5D,WAAEJ,MAAF,EAAUa,EAAV,CAAa,QAAb,EAAuB,KAAKoG,QAAL,CAAcjD,IAAd,CAAmB,IAAnB,CAAvB,EAHqC,CAGa;AACrD,MAJuB,CAItBA,IAJsB,CAIjB,IAJiB,CAAxB;;AAMA,UAAKiD,QAAL;AACH,EAhED;;AAkEA;AACAwD,aAAY3H,SAAZ,CAAsBmE,QAAtB,GAAiC,YAAY;AACzC,SAAIrC,OAAO,IAAX;;AAEAkI,gBAAW,YAAY;AAAE;AACrB,aAAIC,MAAM3M,EAAEJ,MAAF,CAAV;;AAEA,aAAI4E,KAAKpC,IAAL,CAAUsB,KAAV,KAAoBiJ,IAAIjJ,KAAJ,EAAxB,EAAqC;AACjCc,kBAAKpC,IAAL,CAAU9B,GAAV,CAAc;AACVuG,2BAAU,UADA;AAEVC,sBAAK6F,IAAI9C,SAAJ,KAAkB,EAAlB,GAAuB,IAFlB;AAGV9C,uBAAM;AAHI,cAAd;AAKH,UAND,MAMO,IAAIvC,KAAKpC,IAAL,CAAU7B,MAAV,KAAmB,EAAnB,GAAwBoM,IAAIpM,MAAJ,EAA5B,EAA0C;AAC7CiE,kBAAKpC,IAAL,CAAU9B,GAAV,CAAc;AACVuG,2BAAU,UADA;AAEVC,sBAAK6F,IAAI9C,SAAJ,KAAkB,IAFb;AAGV9C,uBAAM4F,IAAIrD,UAAJ,KAAmBqD,IAAIjJ,KAAJ,KAAY,CAA/B,GAAmCc,KAAKpC,IAAL,CAAUsB,KAAV,KAAkB,CAArD,GAAyD;AAHrD,cAAd;AAKH,UANM,MAMA;AACHc,kBAAKpC,IAAL,CAAU9B,GAAV,CAAc;AACVuG,2BAAU,OADA;AAEVC,sBAAK,MAFK;AAGVC,uBAAM4F,IAAIrD,UAAJ,KAAmBqD,IAAIjJ,KAAJ,KAAY,CAA/B,GAAmCc,KAAKpC,IAAL,CAAUsB,KAAV,KAAkB,CAArD,GAAyD;AAHrD,cAAd;AAKH;;AAEDc,cAAKpC,IAAL,CAAU9B,GAAV,CAAc;AACVmM,yBAAY;AADF,UAAd;AAGH,MA1BD,EA0BG,CA1BH;AA2BH,EA9BD;;AAgCApC,aAAY3H,SAAZ,CAAsByG,KAAtB,GAA8B,YAAY;AACtCnJ,OAAE,MAAF,EAAUmG,MAAV;;AAEA,UAAKiG,gBAAL,CAAsB,KAAtB;AACH,EAJD;;AAMA/B,aAAY3H,SAAZ,CAAsB0J,gBAAtB,GAAyC,UAAUQ,OAAV,EAAmB;AACxD,SAAIjK,MAAM3C,EAAEC,QAAF,CAAV;;AAEAD,OAAEC,SAASI,IAAX,EAAiBC,GAAjB,CAAqB;AACjBuM,mBAAUD,UAAU,QAAV,GAAqB;AADd,MAArB;;AAIA,SAAIA,OAAJ,EAAa;AACT,aAAI5F,aAAahH,EAAE,oCAAF,CAAjB;AACAgH,oBAAW1G,GAAX,CAAe;AACXuG,uBAAU,UADC;AAEXC,kBAAK,CAFM;AAGXC,mBAAM,CAHK;AAIXrD,oBAAO,MAJI;AAKXnD,qBAAQoC,IAAIpC,MAAJ,EALG;AAMXyG,yBAAY,gBAND;AAOXC,qBAAQ;AAPG,UAAf;AASAjH,WAAEC,SAASI,IAAX,EAAiB2C,MAAjB,CAAwBgE,UAAxB;AACH,MAZD,MAYO;AACHhH,WAAE,iBAAF,EAAqBmG,MAArB;AACH;AACJ,EAtBD;;SAwBQiE,O,GAAAA,O;SAASuB,M,GAAAA,M;SAAQI,U,GAAAA,U;SAAY1B,W,GAAAA,W;;;;;;ACjYrC;;AAEA;;;;;AACA,UAASyC,mBAAT,CAA8BC,MAA9B,EAAsC5L,QAAtC,EAAgD;AAC5CnB,OAAEgN,IAAF,CAAO;AACH9L,cAAK6L,MADF;AAEHf,eAAM,KAFH;AAGHiB,mBAAU;AAHP,MAAP,EAKC9J,IALD,CAKM,UAAU+J,IAAV,EAAgB;AAClB/L,kBAAS,IAAT,EAAe+L,IAAf;AACH,MAPD,EAQCC,IARD,CAQM,UAAUC,GAAV,EAAeC,MAAf,EAAuB5L,GAAvB,EAA4B;AAC9BN,kBAASM,GAAT;AACH,MAVD;AAWH;;AAED,UAAS6L,iBAAT,CAA4BP,MAA5B,EAAoCzL,IAApC,EAA0CH,QAA1C,EAAoD;AAChDnB,OAAEgN,IAAF,CAAO;AACH9L,cAAK6L,MADF;AAEHf,eAAM,MAFH;AAGH1K,eAAMA,IAHH;AAIHiM,qBAAW;AACP,kBAAK,aAAY;AACbpM,0BAAS,IAAT;AACH,cAHM;AAIP,kBAAK,WAAUqM,KAAV,EAAiB;AAClBrM,0BAASsM,KAAKC,KAAL,CAAWF,MAAMG,YAAjB,CAAT;AACH;AANM;AAJR,MAAP;AAaH;;AAED,UAASC,gBAAT,CAA2Bb,MAA3B,EAAmC5L,QAAnC,EAA6C;AACzCnB,OAAEgN,IAAF,CAAO;AACH9L,cAAK6L,MADF;AAEHf,eAAM,MAFH;AAGHuB,qBAAW;AACP,kBAAK,aAAY;AACbpM,0BAAS,IAAT;AACH,cAHM;AAIP,kBAAK,WAAUqM,KAAV,EAAiB;AAClBrM,0BAASsM,KAAKC,KAAL,CAAWF,MAAMG,YAAjB,CAAT;AACH;AANM;AAHR,MAAP;AAYH;;AAED;AACA,UAASE,mBAAT,CAA6Bd,MAA7B,EAAqCe,IAArC,EAA2C3M,QAA3C,EAAqD;AACjDnB,OAAEgN,IAAF,CAAO;AACH9L,cAAK6L,MADF;AAEHf,eAAM,MAFH;AAGH1K,eAAMwM,IAHH;AAIHC,kBAAS;AACL,4BAAeD,KAAKrF,IAAL,IAAaqF,IADvB,CAC4B;AAD5B,UAJN;AAOHE,sBAAa,KAPV;AAQHC,sBAAa,KARV;AASHV,qBAAW;AACP,kBAAK,aAAY;AACbpM,0BAAS,IAAT;AACH,cAHM;AAIP,kBAAK,WAAUqM,KAAV,EAAiB;AAClBrM,0BAASsM,KAAKC,KAAL,CAAWF,MAAMG,YAAjB,CAAT;AACH;AANM;AATR,MAAP;AAkBH;;AAED,UAASO,qBAAT,CAA+BnB,MAA/B,EAAuC5L,QAAvC,EAAiD;AAC7CnB,OAAEgN,IAAF,CAAO;AACH9L,cAAK6L,MADF;AAEHf,eAAM;AAFH,MAAP,EAIC7I,IAJD,CAIM,YAAY;AACdhC;AACH,MAND,EAOCgM,IAPD,CAOM,UAAUC,GAAV,EAAeC,MAAf,EAAuB5L,GAAvB,EAA4B;AAC9BN,kBAASM,GAAT;AACH,MATD;AAUH;;AAED,UAAS0M,eAAT,CAAyBpB,MAAzB,EAAiC5L,QAAjC,EAA2C;AACvCnB,OAAEgN,IAAF,CAAO;AACH9L,cAAK6L,MADF;AAEHf,eAAM,KAFH;AAGHiB,mBAAU;AAHP,MAAP,EAKC9J,IALD,CAKM,UAAU+J,IAAV,EAAgB;AAClB/L,kBAAS,IAAT,EAAe+L,IAAf;AACH,MAPD,EAQCC,IARD,CAQM,UAAUC,GAAV,EAAeC,MAAf,EAAuB5L,GAAvB,EAA4B;AAC9BN,kBAASM,GAAT;AACH,MAVD;AAWH;;AAED;AACA,UAAS2M,wBAAT,CAAmCrB,MAAnC,EAA2CzE,IAA3C,EAAiDnH,QAAjD,EAA2D;AACvDnB,OAAEgN,IAAF,CAAO;AACH9L,cAAK6L,MADF;AAEHf,eAAM,MAFH;AAGH1K,eAAMgH,OAAOA,KAAK+F,SAAL,EAAP,GAA0B;AAH7B,MAAP,EAKClL,IALD,CAKM,UAAU+J,IAAV,EAAgB;AAClB/L,kBAAS,IAAT,EAAe+L,IAAf;AACH,MAPD,EAQCC,IARD,CAQM,UAAUC,GAAV,EAAeC,MAAf,EAAuB5L,GAAvB,EAA4B;AAC9BN,kBAASsM,KAAKC,KAAL,CAAWN,IAAIO,YAAf,CAAT;AACH,MAVD,EAUG;AACN;;SAEOb,mB,GAAAA,mB;SACAQ,iB,GAAAA,iB;SACAM,gB,GAAAA,gB;SACAC,mB,GAAAA,mB;SACAK,qB,GAAAA,qB;SACAC,e,GAAAA,e;SACAC,wB,GAAAA,wB;;;;;;ACtHR;;AAEA;;;;;AACA,UAASxN,UAAT,CAAoBD,MAApB,EAA4B2N,QAA5B,EAAsCC,GAAtC,EAA2C;AACvCD,gBAAWA,SAAS3J,KAAT,CAAe,GAAf,CAAX;;AAEA,QAAG;AACC,cAAK,IAAIZ,IAAI,CAAb,EAAgBA,IAAIuK,SAASlJ,MAA7B,EAAqCrB,GAArC,EAA0C;AACtC,iBAAKpD,OAAO4F,QAAP,CAAgB+H,SAASvK,CAAT,CAAhB,CAAD,IAAmCpD,OAAOK,IAAP,CAAY,IAAZ,MAAsBsN,SAASvK,CAAT,CAA7D,EAA2E;AACvE,qBAAIwK,GAAJ,EAAS,OAAO5N,OAAO6K,QAAP,CAAgB+C,GAAhB,CAAP,CAAT,KACK,OAAO5N,MAAP;AACR;AACJ;AACDA,kBAASA,OAAOuD,MAAP,EAAT;AACH,MARD,QAQSvD,OAAOyE,MARhB;AASH;;AAED;AACA,UAASoJ,kBAAT,CAA4BC,GAA5B,EAAiC;AAC7B,SAAI7F,QAAQ,EAAZ;AACA,UAAI,IAAIE,IAAR,IAAgB2F,GAAhB,EAAoB;AAChB7F,eAAMvF,IAAN,CAAWyF,IAAX;AACH;AACD,YAAOF,KAAP;AACH;;SAEOhI,U,GAAAA,U;SAAY4N,kB,GAAAA,kB;;;;;;AC1BpB;;;;;mBAMwBE,W;;AAJxB;;AACA;;AAEA;AACe,UAASA,WAAT,CAAqBC,OAArB,EAA8B;AACzC,UAAKvM,IAAL,GAAYpC,EAAE,eAAF,CAAZ;AACA,UAAK4O,YAAL,GAAoB5O,EAAE,gBAAF,CAApB;AACA,UAAKsI,IAAL,GAAY,KAAKlG,IAAL,CAAU+E,IAAV,CAAe,MAAf,CAAZ;AACA,UAAK0H,KAAL,GAAa,KAAKzM,IAAL,CAAU+E,IAAV,CAAe,eAAf,CAAb;;AAEA,UAAK2H,SAAL;;AAEA,UAAKtO,MAAL,GAAc,EAAd;AACA,SAAImO,QAAQnO,MAAZ,EAAoB;AAChB,cAAK,IAAIuD,IAAI,CAAb,EAAgBA,IAAI4K,QAAQnO,MAAR,CAAe4E,MAAnC,EAA2CrB,GAA3C,EAAgD;AAC5C,kBAAKvD,MAAL,CAAYmO,QAAQnO,MAAR,CAAeuD,CAAf,CAAZ,IAAiC,IAAIgL,uBAAJ,CAA4BJ,QAAQnO,MAAR,CAAeuD,CAAf,CAA5B,EAA+C,KAAK3B,IAApD,CAAjC;AACH;AACJ;AACJ;;AAEDsM,aAAYhM,SAAZ,CAAsBoM,SAAtB,GAAkC,YAAY;;AAE1C,UAAKF,YAAL,CAAkBnO,EAAlB,CAAqB,OAArB,EAA8B,KAAKgH,MAAL,CAAY7D,IAAZ,CAAiB,IAAjB,CAA9B;;AAEA5D,OAAEC,SAASuJ,eAAX,EAA4B/I,EAA5B,CAA+B,SAA/B,EAA0C,IAA1C,EAAgD,UAAUC,KAAV,EAAiB;AAC7D,aAAIA,MAAMwJ,OAAN,KAAkB,EAAlB,IAAwBxJ,MAAMsO,OAA9B,IAAyCtO,MAAMuO,QAAnD,EAA6DvO,MAAMY,IAAN,CAAWmG,MAAX;AAChE,MAFD;;AAIA,UAAKrF,IAAL,CAAU3B,EAAV,CAAa,OAAb,EAAsB,KAAKyO,UAAL,CAAgBtL,IAAhB,CAAqB,IAArB,CAAtB;;AAEA5D,OAAE,4BAAF,EAAgCS,EAAhC,CAAmC,OAAnC,EAA4C,KAAKgH,MAAL,CAAY7D,IAAZ,CAAiB,IAAjB,CAA5C;;AAEA,UAAK0E,IAAL,CAAU7H,EAAV,CAAa,QAAb,EAAuB,KAAKW,MAAL,CAAYwC,IAAZ,CAAiB,IAAjB,CAAvB;AAEH,EAdD;;AAgBA8K,aAAYhM,SAAZ,CAAsByM,WAAtB,GAAoC,YAAY;AAC5CnP,OAAEC,SAASuJ,eAAX,EAA4BvF,GAA5B,CAAgC,eAAhC,EAAiD,KAAKmL,IAAtD;AACH,EAFD;;AAIAV,aAAYhM,SAAZ,CAAsB+E,MAAtB,GAA+B,YAAY;AACvC,SAAIjD,OAAO,IAAX;;AAEA,UAAKpC,IAAL,CAAUiN,WAAV,CAAsB,YAAtB;;AAEA,SAAI,CAAC,KAAKjN,IAAL,CAAUmE,QAAV,CAAmB,YAAnB,CAAL,EAAuC;AACnCmG,oBAAW,YAAY;AACnB1M,eAAEC,SAASuJ,eAAX,EAA4B/I,EAA5B,CAA+B,eAA/B,EAAgD+D,IAAhD,EAAsDA,KAAK4K,IAA3D;AACH,UAFD,EAEG,CAFH;AAGH,MAJD,MAIO;AACH,cAAKF,UAAL;AACA,cAAKC,WAAL;AACH;AACJ,EAbD;;AAeAT,aAAYhM,SAAZ,CAAsB0M,IAAtB,GAA6B,UAAU1O,KAAV,EAAiB;AAC1C,SAAIC,SAAS,4BAAWX,EAAEU,MAAMC,MAAR,CAAX,EAA4B,wCAA5B,CAAb;AACA,SAAIA,MAAJ,EAAY;;AAEZ,SAAI6D,OAAO9D,MAAMY,IAAjB;;AAEA,SAAIZ,MAAMwJ,OAAN,IAAiBxJ,MAAMwJ,OAAN,KAAkB,EAAvC,EAA2C;;AAE3C1F,UAAKiD,MAAL;AACAjD,UAAK0K,UAAL,CAAgBxO,KAAhB;AACH,EAVD;;AAYAgO,aAAYhM,SAAZ,CAAsBwM,UAAtB,GAAmC,UAAUxO,KAAV,EAAiB;AAChD;AACA,SAAIA,SAAS,4BAAWV,EAAEU,MAAMC,MAAR,CAAX,EAA4B,uDAA5B,CAAb,EAAmG;;AAEnG,UAAK,IAAIoD,CAAT,IAAc,KAAKvD,MAAnB,EAA2B;AACvB,cAAKA,MAAL,CAAYuD,CAAZ,EAAeqL,IAAf;AACH;AACJ,EAPD;;AASAV,aAAYhM,SAAZ,CAAsBtB,MAAtB,GAA+B,UAAUV,KAAV,EAAiB;AAC5C,SAAI8D,OAAO,IAAX;;AAEA,SAAI9D,KAAJ,EAAWA,MAAMG,cAAN;;AAEX,SAAIyO,UAAU,KAAKhH,IAAL,CAAU+F,SAAV,EAAd;;AAEA,SAAI,CAAC,KAAKQ,KAAL,CAAW1D,GAAX,GAAiB/F,MAAtB,EAA8B;;AAE9B,SAAImK,aAAa,EAAjB;AACA,UAAK,IAAIC,KAAT,IAAkB,KAAKhP,MAAvB,EAA+B;AAC3B+O,oBAAWC,KAAX,IAAoB,KAAKhP,MAAL,CAAYgP,KAAZ,EAAmBzO,OAAnB,EAApB;AACH;;AAED,SAAIM,MAAJ,EACIC,IADJ;;AAGAC,WAAMC,QAAN,CAAe,CACX,UAAUL,QAAV,EAAoB;AAChB,aAAI,CAACsO,KAAKjQ,YAAV,EAAwB,qCAAoB,qBAApB,EAA2C2B,QAA3C,EAAxB,KACKA;AACR,MAJU,EAKX,UAAUA,QAAV,EAAoB;AAChBuO,2BAAkBJ,OAAlB,EAA2BC,UAA3B,EAAuCpO,QAAvC,EAAiDqD,KAAKmL,gBAAtD;AACH,MAPU,CAAf,EAQI,UAAUlO,GAAV,EAAeC,OAAf,EAAwB;AACxB,aAAIhB,KAAJ,EAAW,KAAK+G,MAAL;;AAEX,aAAI/F,QAAQ,CAAR,CAAJ,EAAgB;AACZ+N,kBAAKjQ,YAAL,GAAoB6B,SAASoO,KAAK9N,WAAL,CAAiBD,QAAQ,CAAR,EAAW,CAAX,CAAjB,CAA7B;AACH;;AAED;AACA,aAAI+N,KAAKnQ,UAAT,EAAqB;AACjBmQ,kBAAKnQ,UAAL,CAAgBuC,KAAhB;AACA4N,kBAAKnQ,UAAL,CAAgBgC,IAAhB,CAAqBJ,GAArB,GAA2B,QAA3B;AACH;;AAEDuO,cAAK/P,MAAL,CAAYkQ,IAAZ,CAAiBnC,KAAKoC,SAAL,CAAe;AAC5BP,sBAAS;AADmB,UAAf,CAAjB;AAGH,MAhBE,CAgBA1L,IAhBA,CAgBK,IAhBL,CARH;AAyBH,EA1CD;;AA4CA8K,aAAYhM,SAAZ,CAAsBiN,gBAAtB,GAAyC,UAAUrO,IAAV,EAAgB6B,IAAhB,EAAsB;AAC3D,SAAI,CAACsM,KAAKnQ,UAAV,EAAsB;AAClBmQ,cAAKnQ,UAAL,GAAkB,IAAImQ,KAAK3N,UAAT,CAAoB,iBAApB,EAAuC2N,KAAKlQ,UAA5C,EAAwDkQ,KAAKjQ,YAA7D,CAAlB;AACAiQ,cAAKnQ,UAAL,CAAgBgC,IAAhB,CAAqBJ,GAArB,GAA2B,QAA3B;AACH;AACDuO,UAAKnQ,UAAL,CAAgBsD,GAAhB,CAAoBtB,IAApB,EAA0B6B,IAA1B;AACH,EAND;;AAQA;AACA,UAAS4L,uBAAT,CAAkCtG,IAAlC,EAAwCvE,MAAxC,EAAgD;AAC5C,UAAK9B,IAAL,GAAYpC,EAAE,yCAAF,CAAZ;AACA,UAAKyI,IAAL,GAAYA,IAAZ;AACA,UAAKvE,MAAL,GAAcA,MAAd;;AAEA,UAAKsG,MAAL;AACA,UAAKxI,MAAL;;AAEAuI,YAAOuF,cAAP,CAAsB,IAAtB,EAA4B,MAA5B,EAAoC;AAChCpG,cAAK,eAAY;AACb,kBAAKrJ,IAAL,CAAUe,MAAV;AACA,oBAAO,KAAK2O,KAAZ;AACH;AAJ+B,MAApC;AAMH;;AAEDhB,yBAAwBrM,SAAxB,CAAkC8H,MAAlC,GAA2C,YAAY;AACnD,SAAIhG,OAAO,IAAX;;AAEA,UAAKU,MAAL,GAAclF,EACV;2DAAA,GACqD,KAAKyI,IAD1D,GACiE;;gBAFvD,CAAd;;AAMA,UAAKpI,IAAL,GAAYL,EACR;;iBADQ,CAAZ;;AAKA,UAAKgQ,SAAL,CAAe,UAAUvO,GAAV,EAAewO,MAAf,EAAuB;AAClC,aAAIrL,MAAMsL,WAAV;;AAEA,aAAInM,IAAI,CAAR;AACA,cAAK,IAAI2E,KAAT,IAAkBuH,MAAlB,EAA0B;AACtBrL,iBAAI5B,MAAJ,CAAW,0DAA0D0F,KAA1D,GAAkE,IAAlE,GAAyEA,KAAzE,GAAiF,UAA5F;AACA,iBAAI3E,MAAM,EAAN,KAAa,CAAjB,EAAoBa,MAAMsL,WAAN;AACvB;AACD1L,cAAK2L,SAAL,GAAiBC,KAAKC,IAAL,CAAUtM,IAAE,EAAZ,IAAgB,GAAjC;AACAS,cAAKnE,IAAL,CAAUC,GAAV,CAAc;AACVoD,oBAAOc,KAAK2L,SAAL,GAAiB;AADd,UAAd;AAGAnQ,WAAE,MAAF,EAAUgE,QAAV,CAAmB,YAAa,KAAGoM,KAAKC,IAAL,CAAUtM,IAAE,EAAZ,CAAnC;;AAEA/D,WAAEJ,MAAF,EAAUa,EAAV,CAAa,QAAb,EAAuB+D,KAAK8L,cAAL,CAAoB1M,IAApB,CAAyBY,IAAzB,CAAvB;;AAEA,kBAAS0L,SAAT,GAAqB;AACjB,iBAAIpN,MAAM0B,KAAKnE,IAAL,CAAU8G,IAAV,CAAe,MAAf,CAAV;AAAA,iBACIvC,MAAM5E,EAAE,yBAAF,CADV;AAEA8C,iBAAIE,MAAJ,CAAW4B,GAAX;AACA,oBAAOA,GAAP;AACH;AACJ,MAtBD;;AAwBA,UAAKxC,IAAL,CAAUY,MAAV,CAAiB,KAAKkC,MAAtB;AACA;AACAlF,OAAEC,SAASI,IAAX,EAAiB2C,MAAjB,CAAwB,KAAK3C,IAA7B;;AAEA,UAAKyO,SAAL;AACH,EA3CD;;AA6CAC,yBAAwBrM,SAAxB,CAAkCsN,SAAlC,GAA8C,UAAU7O,QAAV,EAAoB;AAC9D,0CAAoB,wCAAwC,KAAKsH,IAAjE,EAAuEtH,QAAvE;AACH,EAFD;;AAIA4N,yBAAwBrM,SAAxB,CAAkCoM,SAAlC,GAA8C,YAAY;AACtD,UAAK5J,MAAL,CAAYzE,EAAZ,CAAe,OAAf,EAAwB,KAAKgH,MAAL,CAAY7D,IAAZ,CAAiB,IAAjB,CAAxB;AACA,UAAKvD,IAAL,CAAUI,EAAV,CAAa,OAAb,EAAsB,KAAK2O,IAAL,CAAUxL,IAAV,CAAe,IAAf,CAAtB;AACH,EAHD;;AAKAmL,yBAAwBrM,SAAxB,CAAkCV,MAAlC,GAA2C,YAAY;AACnD,UAAKkC,MAAL,CAAYlB,MAAZ,CAAmB,KAAKZ,IAAxB;AACH,EAFD;;AAIA2M,yBAAwBrM,SAAxB,CAAkC+E,MAAlC,GAA2C,YAAY;AACnD,UAAKpH,IAAL,CAAUgP,WAAV,CAAsB,cAAtB;AACA,UAAKiB,cAAL;AACH,EAHD;;AAKAvB,yBAAwBrM,SAAxB,CAAkC0M,IAAlC,GAAyC,UAAU1O,KAAV,EAAiB;AACtD,SAAIA,SAAS,4BAAWV,EAAEU,MAAMC,MAAR,CAAX,EAA4B,KAA5B,CAAb,EAAiD;;AAEjD,UAAKN,IAAL,CAAU2D,QAAV,CAAmB,cAAnB;AACH,EAJD;;AAMA+K,yBAAwBrM,SAAxB,CAAkC4N,cAAlC,GAAmD,YAAY;AAC3DC,kBAAa,KAAKC,mBAAlB;AACA,SAAIhM,OAAO,IAAX;;AAEA,UAAKgM,mBAAL,GAA2B9D,WAAW,YAAY;AAC9C,aAAIC,MAAM3M,EAAEJ,MAAF,CAAV;;AAEA4E,cAAKnE,IAAL,CAAUC,GAAV,CAAc;AACVwG,kBAAKtC,KAAKU,MAAL,CAAYkE,MAAZ,GAAqBtC,GAArB,GAA2BtC,KAAKU,MAAL,CAAYuL,WAAZ,EADtB;AAEVC,oBAAO;AAFG,UAAd;;AAKA,aAAIlM,KAAKnE,IAAL,CAAUwG,QAAV,GAAqBC,GAArB,GAA2BtC,KAAKnE,IAAL,CAAUE,MAAV,EAA3B,GAAgDoM,IAAIpM,MAAJ,EAApD,EAAkE;AAC9DiE,kBAAKnE,IAAL,CAAUC,GAAV,CAAc;AACVuG,2BAAU;AADA,cAAd;AAGH,UAJD,MAIO;AACHrC,kBAAKnE,IAAL,CAAUC,GAAV,CAAc;AACVuG,2BAAU;AADA,cAAd;AAGH;;AAED,aAAI8F,IAAIjJ,KAAJ,KAAcc,KAAK2L,SAAvB,EAAkC;AAC9B3L,kBAAKnE,IAAL,CAAUC,GAAV,CAAc;AACVoD,wBAAOc,KAAK2L,SAAL,GAAiB;AADd,cAAd;AAGH,UAJD,MAIO;AACH3L,kBAAKnE,IAAL,CAAUC,GAAV,CAAc;AACVoD,wBAAOiJ,IAAIjJ,KAAJ,KAAc;AADX,cAAd;AAGH;AACJ,MA3B0B,EA2BxB,GA3BwB,CAA3B;AA4BH,EAhCD;;AAkCAqL,yBAAwBrM,SAAxB,CAAkC3B,OAAlC,GAA4C,YAAY;AACpD,UAAKgP,KAAL,GAAa,KAAK1P,IAAL,CAAUmI,cAAV,EAAb;AACA,YAAO,KAAKuH,KAAZ;AACH,EAHD,C","file":"shop.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap dbe0839ec0362f992761\n **/","\"use strict\";\r\n\r\nimport headMenuListener from \"./headMenu\";\r\nimport {makeDBSearchRequest,\r\n        makeFileSaveRequest,\r\n        makeListRequest,\r\n        makeFileDeleteRequest,\r\n        makeDBDelRequest} from \"./ajaxClient\";\r\nimport {Details, Dialog} from \"./modals\";\r\nimport SearchPanel from \"./searchPanel\";\r\nimport {gatherItemsInOrder} from \"./axillaries\";\r\n\r\nvar mode = \"view\";\r\n\r\nvar thumbnails,\r\n    storedData, //data and configare not necesarily needed to be reloaded on every getData\r\n    storedConfig, //data and configare not necesarily needed to be reloaded on every getData\r\n    searchPanel;\r\n\r\nvar socket = new SockConnection(window.location.origin + \"/sock\");\r\nsocket.connect();\r\n\r\n$(document).ready(function () {\r\n    headMenuListener();\r\n\r\n    var editPanel = new EditPanel();\r\n\r\n    $(document.body).css({\r\n        height: $(window).height()\r\n    });\r\n\r\n    searchPanel = new SearchPanel({\r\n        popups:[\r\n            \"Производитель\"\r\n        ]\r\n    });\r\n\r\n    $(\".side-menu\").on(\"click\", \".menu-button\", function (event) {\r\n        var target = $(event.target);\r\n        target = findTarget(target, \"menu-button\", \"a\");\r\n        if(!target) {\r\n            event.preventDefault();\r\n            return;\r\n        };\r\n\r\n        sideMenuActive(target);\r\n\r\n        getData(target.attr(\"href\"), createContent);\r\n\r\n        event.preventDefault();\r\n    });\r\n});\r\n\r\nfunction getData(url, callback) {\r\n    if (url === \"search\") {\r\n        searchPanel.submit();\r\n        return;\r\n    }\r\n\r\n    var config,\r\n        data;\r\n\r\n    async.parallel([\r\n        //get configuration\r\n        function (callback) {\r\n            makeDBSearchRequest(\"/dbsearch?db=Config\", callback);\r\n        },\r\n        function (callback) {\r\n            makeDBSearchRequest(url, callback);\r\n        }\r\n    ], function (err, results) {\r\n        storedConfig = config = parseConfig(results[0][0]);\r\n        storedData = data = results[1];\r\n        data.url = url;\r\n\r\n        if (err) {\r\n            alert(\"Извините, проблема с базой данных\");\r\n            return;\r\n        };\r\n\r\n        callback(data, config);\r\n    });\r\n};\r\n\r\nfunction createContent (data, config) {\r\n    //if called without any of the arguments, that argument is taken from the global variable\r\n    //data and config are stored in global variables when they are taken from the database\r\n    var data = data || storedData,\r\n        config = config || storedConfig;\r\n\r\n    if (!data && thumbnails) {\r\n        thumbnails.clear();\r\n    } \r\n    if(!config) return;\r\n\r\n    if (!thumbnails) thumbnails = new Thumbnails(\"#commodity-list\", data, config);\r\n    thumbnails.clear();\r\n    thumbnails.build(data, config);\r\n    thumbnails.render();\r\n};\r\n\r\n//parse the config object------------------------------------------------------------------------------------------\r\nfunction parseConfig(config) {\r\n    for (var field in config.showcase) {\r\n        if (config.showcase[field].css) {\r\n            config.showcase[field].css = new Function (\"data\", config.showcase[field].css);\r\n        };\r\n    };\r\n\r\n    return config;\r\n};\r\n\r\n//Thumbnails-------------------------------------------------------------------------------------------------------\r\nfunction Thumbnails (elem, config) {\r\n    this.elem = $(elem);\r\n    this.tiles = new Set();\r\n    this.previousWindowWidth = 0;\r\n    this.focusExecuted = false;\r\n\r\n    this.data = [];\r\n\r\n    this.setHandlers();\r\n};\r\n\r\nThumbnails.prototype.build = function (data, config) {\r\n    if (!data) return;\r\n\r\n    this.data = data;\r\n    this.config = config;\r\n\r\n    for (var doc of this.data) {\r\n        this.tiles.add((new Thumbnail(this, doc, this.config, this.data.url)).elem);\r\n    };\r\n};\r\n\r\nThumbnails.prototype.render = function () {\r\n    this.row = $(\"<div class='row'></div>\");\r\n\r\n    for (var tile of this.tiles) {\r\n        this.row.append(tile);\r\n    };\r\n\r\n    this.elem.append(this.row);\r\n\r\n    this.clearTiles(true)();\r\n};\r\n\r\nThumbnails.prototype.add = function (dataToAdd, done) {\r\n    if (!this.row) {\r\n        this.row = $(\"<div class='row'></div>\");\r\n        this.elem.append(this.row);\r\n    };\r\n\r\n    var newThumbnail = (new Thumbnail(this, dataToAdd, this.config || storedConfig, \"search\"));\r\n\r\n    this.tiles.add(newThumbnail.elem);\r\n    this.row.append(newThumbnail.elem);\r\n    this.clearTiles(true);\r\n\r\n    this.data.push(dataToAdd);\r\n    storedData = this.data;\r\n\r\n    if (done) {\r\n        this.clearTiles(true)();\r\n    };\r\n};\r\n\r\nThumbnails.prototype.clear = function () {\r\n    this.data = [];\r\n    this.tiles.clear();\r\n    if (this.row) this.row.html(\"\");\r\n};\r\n\r\nThumbnails.prototype.unrender = function () {\r\n    this.elem.html(\"\");\r\n};\r\n\r\n//Need theese two functions to deal with tiles of differrent height\r\n//The first one defines, if the clearance should be done on a particular resize\r\nThumbnails.prototype.clearTiles = function (executeAnyway) {\r\n\r\n    return function () {\r\n        var windowWidth = $(window).width();\r\n\r\n        if (windowWidth < 768) {\r\n            if (this.previousWindowWidth >= 768 || executeAnyway) {\r\n                this.arrangeClears();\r\n            }\r\n        } else if (windowWidth >= 768 && windowWidth < 992) {\r\n            if (this.previousWindowWidth < 768 || this.previousWindowWidth >= 992 || executeAnyway) {\r\n                this.arrangeClears(3);\r\n            };\r\n        } else if (windowWidth >= 992 && windowWidth < 1200) {\r\n            if (this.previousWindowWidth < 992 || this.previousWindowWidth >= 1200 || executeAnyway) {\r\n                this.arrangeClears(4);\r\n            };\r\n        } else {\r\n            if (this.previousWindowWidth < 1200 || executeAnyway) {\r\n                this.arrangeClears(5);\r\n            };\r\n        }\r\n\r\n        this.previousWindowWidth = windowWidth;\r\n    }.bind(this);\r\n\r\n};\r\n\r\n//The second one does the clearance\r\nThumbnails.prototype.arrangeClears = function (clearThis) {\r\n    if (!clearThis) {\r\n        for (var tile in this.tiles) {\r\n            tile.removeClass(\"first-in-a-row\");\r\n        };\r\n        return;\r\n    };\r\n\r\n    clearThis--;\r\n\r\n    var i = 0;\r\n    for (var tile of this.tiles) {\r\n        if (i%clearThis === 0) {\r\n            tile.addClass(\"first-in-a-row\");\r\n        } else {\r\n            tile.removeClass(\"first-in-a-row\");\r\n        };\r\n        i++;\r\n    };\r\n};\r\n\r\nThumbnails.prototype.setHandlers = function () {\r\n    $(window).on(\"resize\", this.clearTiles(false));\r\n\r\n    //Crazy firefox' feature that js isn't executed again, when a page is returned to, but window.onresize is lost, when a page is left\r\n    //So I listen to document.onfocus and add window.onresize again\r\n    $(document).on(\"focus\", function () {\r\n        if (this.focusExecuted) return;\r\n\r\n        this.focusExecuted = true;\r\n\r\n        this.clearTiles(true)();\r\n        $(window).off(\"resize\", this.clearTiles(false)); //just in case\r\n        $(window).on(\"resize\", this.clearTiles(false)); //when comming back from anothr page\r\n    }.bind(this));\r\n\r\n    //if we go away from the page by some link, when we come back we will need to add window.onresize again\r\n    $(document).on(\"click\", function (event) {\r\n        if ($(event.target).attr(\"href\")) this.focusExecuted = false;\r\n        $(window).off(\"resize\", this.clearTiles(false)); //just in case\r\n        $(window).on(\"resize\", this.clearTiles(false)); //when an element with href is pressed, but page hasn't been reloaded\r\n    }.bind(this));\r\n};\r\n\r\n//Thumbnail--------------------------------------------------------------------------------------------------------\r\nfunction Thumbnail (parent, data, config, dataUrl) {\r\n    this.parent = parent;\r\n    this.data = data || {\r\n        img: undefined,\r\n        specs:{}\r\n    };\r\n    this.dataUrl = dataUrl;\r\n    this.details = new Details(this);\r\n    var self = this;\r\n\r\n    //config = undefined;\r\n    if (!config) {\r\n        config = {\r\n            showcase: {\r\n                \"Название\": {\r\n                    withTitle: false\r\n                },\r\n                \"Цена\": {\r\n                    withTitle: false,\r\n                    css: {\r\n                        color: \"#c00\"\r\n                    }\r\n                },\r\n                \"В наличии\": {\r\n                    withTitle: true,\r\n                    css: (+(data.specs[\"В наличии\"].split(\" \")[0]) ? {\r\n                        color: \"#0f0\"\r\n                    } : {\r\n                        color: \"#f00\"\r\n                    })\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    var col = $(\"<div class='col-sm-6 col-md-4 col-lg-3'></div>\");\r\n\r\n    var div = $(\"<div class='thumbnail'></div>\");\r\n    div.css({\r\n        textAlign: \"right\",\r\n    });\r\n\r\n    var img = $(\"<img src=\" + (this.data.img || \"'images/defaultPic.gif'\") + \" class='thumbnail-img'>\");\r\n    //make the image clickable\r\n    if (mode === \"edit\") {\r\n        img.hover(function () {\r\n            $(this).css({\r\n                cursor: \"pointer\"\r\n            })\r\n        });\r\n        img.on(\"click\", this.chooseImage.bind(this));\r\n    };\r\n\r\n    var button = $(\"<button type='button' class='btn btn-default details-button' data-toggle='modal' data-target='details'>\" + (mode === \"view\"? \"Подробнее>>\" : \"Редактировать>>\") + \"</button>\");\r\n    button.on(\"click\", function (event) {\r\n        self.details.render();\r\n    });\r\n    \r\n    div.append(img);\r\n\r\n    var fields = gatherItemsInOrder(config.showcase);\r\n    for (var i = fields.length-1; i >= 0; i--) {\r\n        if (this.data.specs[fields[i]]) {\r\n            var p = $(\"<p>\" + ((config.showcase[fields[i]].withTitle) ? (fields[i] + \": \" + this.data.specs[fields[i]]) : (this.data.specs[fields[i]])) + \"</p>\");\r\n            if (config.showcase[fields[i]].css) p.css(config.showcase[fields[i]].css(this.data));\r\n            div.append(p);\r\n        };\r\n    };\r\n\r\n    div.append(button);\r\n\r\n    if (mode === \"edit\") col.on(\"contextmenu\", this.showPopupMenu.bind(this));\r\n\r\n    col.append(div);\r\n\r\n    //return col;\r\n    this.elem = col;\r\n};\r\n\r\nThumbnail.prototype.chooseImage = function (event) {\r\n    $(\"#uploadInput\").trigger(\"click\", [this.data._id]);\r\n};\r\n\r\nThumbnail.prototype.chooseImageOnServer = function (event) {\r\n    var target = $(event.target);\r\n    target = findTarget(target, \"popup-button\");\r\n    if(!target) return;\r\n\r\n    var self = this;\r\n    makeFileSaveRequest(\"/savefile?id=\" + this.data._id, target.text(), function (err) {\r\n        if (err) alert (err.message);\r\n        getData(self.dataUrl, createContent);\r\n    });\r\n};\r\n\r\nThumbnail.prototype.showDirList = function (event) {\r\n    makeListRequest(\"/list?dir=images\" , (err, list) => {\r\n        if (err) alert(err.messge);\r\n        \r\n        var files = {};\r\n        for (var i = 0; i < list.length; i++) {\r\n            files[list[i]] = [this.chooseImageOnServer.bind(this), this.showDirPopupMenu.bind(this)];\r\n        };\r\n        \r\n        var menu = new PopupMenu(this.elem, event, files, true);\r\n        menu.elem.addClass(\"dir-list\");\r\n    });\r\n};\r\n\r\nThumbnail.prototype.showDirPopupMenu = function (event) {\r\n    $(\".popup-menu[unremovable='false']\").remove();\r\n\r\n    var target = findTarget($(event.target), \"popup-button\");\r\n    if (!target) return;\r\n    \r\n    this.selectedImage = target.text();\r\n    \r\n    var menu = new PopupMenu(this.elem, event, {\r\n        \"Посмотреть\": [this.showImage.bind(this)],\r\n        \"Удалить\": [this.deleteImage.bind(this)]\r\n    });\r\n};\r\n\r\nThumbnail.prototype.showPopupMenu = function (event) {\r\n    var target = findTarget($(event.target), \"thumbnail thumbnail-img details-button popup-menu\");\r\n    if (!target) {\r\n        $(\".popup-menu\").remove();\r\n        return;\r\n    };\r\n\r\n    if (!target.hasClass(\"popup-menu\")) $(\".popup-menu\").remove();\r\n\r\n    if (target.hasClass(\"thumbnail\")) {\r\n        var popupMenu = new PopupMenu(this.elem, event, {\r\n            \"Удалить товар\": [this.delete.bind(this)]\r\n        });\r\n    } else if (target.hasClass(\"thumbnail-img\")) {\r\n        var popupMenu = new PopupMenu(this.elem, event, {\r\n            \"Загрузить новое изображение\": [this.chooseImage.bind(this)],\r\n            \"Выбрать изображение на сервере\": [this.showDirList.bind(this)]\r\n        });\r\n    } else if (target.hasClass(\"details-button\")) {\r\n        return;\r\n    };\r\n\r\n    event.preventDefault();\r\n};\r\n\r\nThumbnail.prototype.showImage = function (event) {\r\n    $(\"#image-preview\").remove();\r\n    var parentList = $(\".dir-list\");\r\n    \r\n    this.iframe = $(\"<iframe id='image-preview' src='images/\" + this.selectedImage + \"' scrolling='no'></iframe>\");\r\n    this.iframe.appendTo(parentList.parent()); \r\n    this.iframe.css({\r\n        position: \"absolute\",\r\n        top: parentList.position().top + \"px\",\r\n        left: parentList.position().left + parentList.width() + \"px\",\r\n        background: \"#fff\",\r\n        zIndex: \"1\"\r\n    });\r\n\r\n    this.iframe.on(\"load\", (function () {\r\n        var img = this.iframe.contents().find(\"img\");\r\n        if ((img.width() > img.height()) && img.width() > this.iframe.width()) {\r\n            $(img).css({\r\n                width: \"100%\"\r\n            });\r\n        } else if (img.height() > this.iframe.height()) {\r\n            $(img).css({\r\n                height: \"100%\"\r\n            });\r\n        };\r\n    }).bind(this));\r\n};\r\n\r\nThumbnail.prototype.deleteImage = function (event) {\r\n    makeFileDeleteRequest(\"/delfile?dir=images&file=\" + this.selectedImage, function (err) {\r\n        if (err) alert(err.message);\r\n        getData(data.url, createContent);\r\n    });\r\n};\r\n\r\nThumbnail.prototype.delete = function (event) {\r\n    var self = this;\r\n    makeDBDelRequest(\"/dbdel?db=Commodity&id=\" + this.data._id, function (err) {\r\n        if (err) alert (err.message);\r\n        getData(self.dataUrl, createContent);\r\n    });\r\n};\r\n\r\n//Edit switch----------------------------------------------------------------------------------------------------------\r\nfunction EditSwitch(parent) {\r\n    this.parent = parent;\r\n\r\n    this.elem = $(\"<button type='button' class='btn btn-default'>Редактировать</button>\");\r\n    //this.elem.appendTo(document.body);\r\n    this.elem.appendTo($(\".main-content\"));\r\n\r\n    this.elem.css({\r\n        float: \"right\",\r\n        margin: \"5px\"\r\n        /*position: \"absolute\",\r\n        top: \"95%\",\r\n        left: \"90%\"*/\r\n    });\r\n\r\n    $(this.elem).on(\"click\", this.switchMode.bind(this));\r\n};\r\n\r\nEditSwitch.prototype.switchMode = function () {\r\n    if (mode !== \"edit\") {\r\n        mode = \"edit\";\r\n        this.elem.text(\"Просмотр\");\r\n        //create an input for uploading an image for a thumbnail\r\n        if (!$(\"#uploadInput\").length) this.createUploadInput();\r\n    } else {\r\n        mode = \"view\";\r\n        this.elem.text(\"Редактировать\");\r\n    };\r\n\r\n    createContent();\r\n\r\n    this.parent.toggle();\r\n};\r\n\r\nEditSwitch.prototype.createUploadInput = function () {\r\n    var uploadInput = $(\"<input type='file'>\");\r\n    uploadInput.attr(\"id\", \"uploadInput\");\r\n    uploadInput.css({\r\n        width: \"0\",\r\n        height: \"0\",\r\n        border: \"0\",\r\n        padding: \"0\"\r\n    });\r\n    $(document.body).append(uploadInput);\r\n\r\n    var callerId;\r\n\r\n    uploadInput.on(\"click\", (event, id) => {\r\n        callerId = id;\r\n    });\r\n\r\n    uploadInput.on(\"change\", function (event) {\r\n        makeFileSaveRequest(\"/savefile?id=\" + callerId, this.files[0], function (err) {\r\n            if (err) alert (err.message);\r\n            getData(storedData.url, createContent);//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n        });\r\n    });\r\n};\r\n\r\n//Edit panel-----------------------------------------------------------------------------------------------------------\r\nfunction EditPanel () {\r\n    if ($(\".main-content\").attr(\"admin-mode\") === \"true\") this.switch = new EditSwitch(this);\r\n\r\n    this.elem = $(\".edit-panel\");\r\n    this.elem.on(\"click\", \".edit-button\", this.buttonClick.bind(this));\r\n};\r\n\r\nEditPanel.prototype.buttonClick = function (event) {\r\n    var target = findTarget($(event.target), \"edit-button\");\r\n    switch (target.attr(\"id\")) {\r\n        case \"add-commodity\":\r\n            this.addCommodity();\r\n            return;\r\n        case \"add-category\":\r\n            this.addCategory();\r\n            return;\r\n    };\r\n};\r\n\r\nEditPanel.prototype.toggle = function () {\r\n    if (this.elem.attr(\"hidden\")) this.elem.removeAttr(\"hidden\");\r\n    else this.elem.attr(\"hidden\", \"true\");\r\n};\r\n\r\nEditPanel.prototype.addCommodity = function () {\r\n    var questionnaire = new Dialog ({\r\n        \"Категория\": \"Лыжи\",\r\n        \"Название\": \"\"\r\n    }, \"Commodity\");\r\n\r\n    questionnaire.render();\r\n};\r\n\r\nEditPanel.prototype.addCategory = function () {\r\n    var dialog = new Dialog({\"Категория\": \"\"}, \"Category\", function (form) {\r\n        var formData = form.serializeArray();\r\n        return {\r\n            name: formData[1].value,\r\n            url: \"/dbsearch?db=Commodity&specs=specs.Категория:\" + formData[1].value,\r\n            position: $(\".menu-button\").length\r\n        };\r\n    }, function (err, data) {\r\n        if (err) {\r\n            if (err.message === \"Документ уже существует\") alert(\"Яна, категория с таким имененм у тебя уже есть\");\r\n            else alert(err.message);\r\n            return;\r\n        }\r\n\r\n        $(\".side-menu\").append(\"\\\r\n            <li class='menu-button'>\\\r\n                <a role='presentation' href='\" + data.url + \"'>\" + data.name + \"</a>\\\r\n            </li>\\\r\n        \");\r\n    });\r\n    dialog.render();\r\n};\r\n\r\n//Popup menu-----------------------------------------------------------------------------------------------------------\r\nfunction PopupMenu(parent, invokingEvent, items, unremovable) { //unremovable means this popup should not be deleted on popup on itself\r\n    this.parent = parent;\r\n    this.elem = $(\"<div class='popup-menu'\" + (unremovable ? \"unremovable='true'\" : \"unremovable='false'\") + \"></div>\");\r\n    this.list = $(\"<ul class='list-group'></ul>\");\r\n    \r\n    for (var item in items) {\r\n        this.addField(item, items[item] ? items[item][0] : null, items[item] ? items[item][1] : null);\r\n    };\r\n    \r\n    this.elem.append(this.list);\r\n    \r\n    this.render(invokingEvent);\r\n};\r\n\r\nPopupMenu.prototype.addField = function (itemName, onclick, oncontextmenu) {\r\n    var item = $(\"<li class='btn list-group-item popup-button'>\" + itemName + \"</li>\");\r\n\r\n    this.list.append(item);\r\n\r\n    item.on(\"click\", (function (event) {\r\n        if (onclick) onclick(event);\r\n        event.preventDefault();\r\n        this.close();\r\n    }).bind(this));\r\n\r\n    item.on(\"contextmenu\", (function (event) {\r\n        if (oncontextmenu) oncontextmenu(event);\r\n        event.preventDefault();\r\n    }).bind(this));\r\n};\r\n\r\nPopupMenu.prototype.render = function (invokingEvent) {\r\n    var offset = this.parent.offset()\r\n    this.parent.append(this.elem);\r\n    this.elem.css({\r\n        position: \"absolute\",\r\n        left: invokingEvent ? (invokingEvent.clientX - offset.left + $(window).scrollLeft() + \"px\") : \r\n            ((window.pageXOffset || document.documentElement.scrollLeft) + (document.documentElement.clientWidth/2) - (this.elem.get(0).offsetWidth/2) - offset.left + \"px\"),\r\n        top: invokingEvent ? (invokingEvent.clientY - offset.top + $(window).scrollTop() + \"px\") : \"10%\",\r\n        zIndex: \"1\"\r\n    });\r\n};\r\n\r\nPopupMenu.prototype.close = function () {\r\n    this.elem.detach();\r\n};\r\n\r\nexport {storedConfig, storedData, socket, parseConfig, thumbnails, Thumbnails};\n\n\n/** WEBPACK FOOTER **\n ** ./shopClient.js\n **/","\"use strict\";\r\n\r\nimport {ModalWindow, AuthWindow} from \"./modals\";\r\nimport {makeAuthorizationRequest} from \"./ajaxClient\";\r\nimport {findTarget} from \"./axillaries\";\r\n\r\nexport default function headMenuListener () {\r\n    \r\n    $(document).ready(function () {\r\n        $(\"#signin, #signup\").on(\"click\", function (event) {\r\n            event.preventDefault();\r\n\r\n            var target = findTarget($(event.target), \"signin signup\");\r\n            if (!target) return;\r\n            \r\n            showAuthWindow(target.attr(\"id\"));\r\n        });\r\n        \r\n        $(\"#signout\").on(\"click\", function (event) {\r\n            event.preventDefault();\r\n\r\n            var target = findTarget($(event.target), \"signout\");\r\n            if (!target) return;\r\n\r\n            makeAuthorizationRequest(\"/signout\", null, function (err) {\r\n                if (err) alert (err.message);\r\n                else window.location.href = \"/\";\r\n            });\r\n        });\r\n\r\n        //Close all popups and modals, if there are any-------------------------------------------------------------------------------------------------------------------------------\r\n        $(document.documentElement).on(\"click keydown\", function (event) {\r\n            if (event.keyCode && event.keyCode !== 27) return;\r\n\r\n            if (findTarget($(event.target), \"mod\")) return;\r\n\r\n            //close image preview and popups\r\n            if(!findTarget($(event.target), \"popup-button\") || event.keyCode === 27) {\r\n                $(\"#image-preview\").remove();\r\n                $(\".popup-menu\").detach();\r\n            };\r\n            \r\n            //if click is not on a details button, close all details\r\n            if(!findTarget($(event.target), \"details-button edit-button rm-button signin signup\") || event.keyCode === 27) {\r\n                ModalWindow.prototype.close();\r\n            };\r\n        });\r\n    });\r\n    \r\n    function showAuthWindow(id) {\r\n        var authWindow = new AuthWindow(id);\r\n        authWindow.render();\r\n    };\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./headMenu.js\n **/","\"use strict\";\r\n\r\nimport {makeDBSaveRequest, makeAuthorizationRequest} from \"./ajaxClient\";\r\nimport {findTarget, gatherItemsInOrder} from \"./axillaries\";\r\n\r\n//Details---------------------------------------------------------------------------------------------------------------\r\nfunction Details (parent) {\r\n    if (!parent.data) return;\r\n    \r\n    ModalWindow.call(this, false);\r\n\r\n    this.parent = parent;\r\n\r\n    this.elem.attr(\"id\", \"details\");\r\n    this.elem.css({\r\n        background: \"#079\",\r\n        padding: \"0px\"\r\n    });\r\n};\r\n\r\nDetails.prototype = Object.create(ModalWindow.prototype);\r\nDetails.prototype.constructor = Details;\r\n\r\nDetails.prototype.render = function () {\r\n    var self = this;\r\n\r\n    if (!this.elem.html()) {\r\n        this.content = $(\"<form></form>\");\r\n        \r\n        this.createContent();\r\n        \r\n        if (mode === \"edit\") {\r\n            var saveButton = $(\"<button type='submit' class='btn btn-default' id='save-button'>Сохранить</button>\");\r\n            saveButton.css({\r\n                float: \"right\"\r\n            });\r\n\r\n            var addButton = $(\"<button type='button' class='btn btn-default' id='add-button'>Добавить</button>\");\r\n\r\n            var cancelButton = $(\"<button type='button' class='btn btn-default' id='cancel-button'>Отмена</button>\");\r\n            cancelButton.css({\r\n                float: \"right\"\r\n            });\r\n\r\n            this.content.append(cancelButton);\r\n            this.content.append(addButton);\r\n            this.content.append(saveButton);\r\n        };\r\n    };\r\n    \r\n    this.content.on(\"submit\", this.submit.bind(this));\r\n    this.content.on(\"click\", \".btn\", this.editButtonClick.bind(this));\r\n\r\n    this._render(this.content);\r\n};\r\n\r\nDetails.prototype.createContent = function () {\r\n    this.elem.find(\"#details__content\").remove();\r\n    \r\n    var panel = $(\"<div class='panel panel-default' id='details__content'></div>\");\r\n    this.table = $(\"<table class='table'><tbody></tbody></table>\");\r\n\r\n    //for some reason properties are read in the opposite order\r\n    var items = gatherItemsInOrder(this.parent.data.specs);\r\n\r\n    for (var i = items.length - 1; i >= 0; i--) {\r\n        this.addField(this.table.find(\"tbody\"), {key: items[i], val: this.parent.data.specs[items[i]]});\r\n    };\r\n\r\n    panel.append(this.table);\r\n    this.content.prepend(panel);\r\n};\r\n\r\nDetails.prototype.editButtonClick = function (event) {\r\n    var target = $(event.target);\r\n    target = findTarget(target, \"btn\");\r\n    if (!target) return;\r\n\r\n    switch (target.attr(\"id\")) {\r\n        case \"add-button\":\r\n            this.addField(this.table.find(\"tbody\"));\r\n            break;\r\n        case \"rm-button\":\r\n            this.removeField(this.table.find(\"tbody\"), target.attr(\"num\"));\r\n            break;\r\n        case \"cancel-button\":\r\n            this.createContent();\r\n            this.close();\r\n            break;\r\n    };\r\n    \r\n    target.blur();\r\n};\r\n\r\nDetails.prototype.addField = function (container, value) {\r\n    if (mode === \"edit\") {\r\n        container.append(\r\n            \"<tr>\\\r\n                <td><input name='key' value='\" + (value ? value.key : \"\") + \"'></td>\\\r\n                <td><input name='val' value='\" + (value ? value.val : \"\") +\"'></td>\\\r\n                <td><input type='button' class='btn' id='rm-button' num='\" + container.children().length + \"' value='Удалить'></td>\\\r\n            </tr>\");\r\n    } else {\r\n        container.append(\r\n            \"<tr>\\\r\n                <td>\" + (value ? value.key : \"\") + \"</td>\\\r\n                <td>\" + (value ? value.val : \"\") + \"</td>\\\r\n            </tr>\");\r\n    };\r\n};\r\n\r\nDetails.prototype.removeField = function (container, num) {\r\n    container.children().eq(+num).remove();\r\n    \r\n    for (var i = +num; i < container.children().length; i++) {\r\n        container.children().eq(i).find(\"input\").attr(\"num\", i);\r\n    };\r\n};\r\n\r\nDetails.prototype.submit = function (event) {\r\n    var form = $(event.target);\r\n\r\n    var self = this;\r\n    makeDBSaveRequest(\"/dbsave?db=Commodity&id=\" + this.parent.data._id, form.serializeArray(), function (err) {\r\n        if (err) alert (err.message);\r\n        getData(self.parent.dataUrl, createContent);\r\n    });\r\n\r\n    this.close();\r\n\r\n    event.preventDefault();\r\n};\r\n\r\n//Dialog-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n//createData - function to create data, if data to be submitted doesn't comply with data in form\r\n//callback - to be called after a data is saved to a database\r\nfunction Dialog (items, db, createData, callback) {\r\n    var fakeParent = {\r\n        data: {\r\n            _id: null,\r\n            specs: items\r\n        }\r\n    };\r\n\r\n    Details.call(this, fakeParent);\r\n\r\n    this.db = db;\r\n    this.createData = createData;\r\n    this.callback = callback;\r\n};\r\n\r\nDialog.prototype = Object.create(Details.prototype);\r\nDialog.prototype.constructor = Dialog;\r\n\r\nDialog.prototype.submit = function (event) {\r\n    var self = this;\r\n    var form = $(event.target);\r\n\r\n    if (this.createData) var formData = this.createData(form);\r\n    else var formData = form.serializeArray();\r\n\r\n    if (!formData.url && storedData) formData.url = storedData.url;\r\n    makeDBSaveRequest(\"/dbsave?db=\" + this.db + \"&id=\" + this.parent.data._id, formData, function (err) {\r\n        if (err) {\r\n            if (self.callback) self.callback(err);\r\n            else alert (err.message);\r\n            return;\r\n        }\r\n\r\n        if (formData) {\r\n            getData(formData.url, function () {\r\n                createContent();\r\n                if (self.callback) self.callback(null, formData);\r\n\r\n                if (self.db === \"Category\") {\r\n                    sideMenuActive($(\".side-menu a[href='\" + formData.url + \"']\"));\r\n                };\r\n            });\r\n        };\r\n    });\r\n\r\n    this.close();\r\n\r\n    event.preventDefault();\r\n};\r\n\r\n//Authentification Window----------------------------------------------------------------------------------------------------------------------------------------------------\r\nfunction AuthWindow (type) {\r\n    ModalWindow.call(this, true);\r\n    \r\n    this.elem.attr(\"id\", \"authentification\");\r\n    this.elem.css({\r\n        background: \"#fff\",\r\n        padding: \"5px\",\r\n        border: \"1px solid #ccc\",\r\n        borderRadius: \"5px\"\r\n    });\r\n\r\n    this.type = type;\r\n};\r\n\r\nAuthWindow.prototype = Object.create(ModalWindow.prototype);\r\nAuthWindow.prototype.constructor = AuthWindow;\r\n\r\nAuthWindow.prototype.render = function () { \r\n    this.form = $(\r\n    \"<form>\\\r\n        <div class='form-group'>\\\r\n            <label for='username' class='sr-only'>Имя пользователя</label>\\\r\n                <input type='text' class='form-control' name='username' id='username' placeholder='Имя пользователя'>\\\r\n        </div>\\\r\n        <div class='form-group'>\\\r\n            <label for='password' class='sr-only'>Пароль</label>\\\r\n                <input type='password' class='form-control' name='password' id='password' placeholder='Пароль' autocomplete='off'>\\\r\n        </div>\\\r\n    </form>\");\r\n    \r\n    this.form.css({\r\n        minWidth: 300\r\n    });\r\n\r\n    var button = $(\"<button type='submit' class='btn btn-primary' id='auth-button'>\" + ((this.type === \"signin\") ? \"Войти\" : (this.type === \"signup\") ? \"Регистрация\" : \"\") + \"</button>\");\r\n    button.css({\r\n        margin: \"0 10px 10px 10px\",\r\n        float: \"right\"\r\n    });\r\n    this.form.append(button);\r\n\r\n    this.form.on(\"submit\", this.submit.bind(this));\r\n    \r\n    this._render(this.form);\r\n};\r\n\r\nAuthWindow.prototype.submit = function (event) {\r\n    makeAuthorizationRequest(\"/\" + this.type, this.form, function (err) {\r\n        if (err) alert (err.message);\r\n        else {\r\n            ModalWindow.prototype.close();\r\n            location.reload();\r\n        };\r\n    });\r\n\r\n    event.preventDefault();\r\n};\r\n\r\n//Modal window---------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n//romove shows if the window should be removed whe deleted or jast detach\r\nfunction ModalWindow () {\r\n    this.elem = $(\"<div class='mod'></div>\");\r\n    this.elem.css({\r\n        zIndex: 3\r\n    });\r\n    \r\n    this.focusExecuted = false;\r\n};\r\n\r\nModalWindow.prototype._render = function (content) {\r\n    this.close();\r\n    \r\n    this.preventScrolling(true);\r\n\r\n    if (!this.elem.html()) {\r\n        if (content) this.elem.append(content);\r\n\r\n        this.closeButton = $(\"<div></div>\");\r\n        this.closeButton.css({\r\n            width: \"20px\",\r\n            height: \"20px\",\r\n            float: \"right\"\r\n        });\r\n        var closeImg = $(\"<img src='/images/gtk-close.png'>\");\r\n        closeImg.css({\r\n            width: \"100%\",\r\n            height: \"100%\"\r\n        });\r\n        this.closeButton.append(closeImg);\r\n        this.closeButton.hover(function () {\r\n            $(this).css({\r\n                cursor: \"pointer\"\r\n            })\r\n        });\r\n\r\n        var clearFix = ($(\"<div class='clearfix'></div>\"));\r\n\r\n        this.elem.prepend(this.closeButton);\r\n        clearFix.insertAfter(this.closeButton);\r\n\r\n        this.elem.css({\r\n            position: \"fixed\"\r\n        });\r\n    };\r\n\r\n    this.elem.css({\r\n        visibility: \"hidden\" //To prevent scampering of a modal across the window, visibility is restored after positioning\r\n    });\r\n    $(document.body).append(this.elem);\r\n\r\n    this.closeButton.on(\"click\", this.close.bind(this));\r\n\r\n    $(window).on(\"resize\", this.position.bind(this));\r\n    \r\n    //Crazy firefox' feature that js isn't executed again, when a page is returned to, but window.onresize is lost, when a page is left\r\n    //So I listen to document.onfocus and add window.onresize again\r\n    $(document).on(\"focus\", function () {\r\n        if (this.focusExecuted) return;\r\n\r\n        this.focusExecuted = true;\r\n        \r\n        $(window).off(\"resize\", this.position.bind(this)); //just in case\r\n        $(window).on(\"resize\", this.position.bind(this)); //when comming back from anothr page\r\n    }.bind(this));\r\n\r\n    //if we go away from the page by some link, when we come back we will need to add window.onresize again\r\n    $(document).on(\"click\", function (event) {\r\n        if ($(event.target).attr(\"href\")) this.focusExecuted = false;\r\n        $(window).off(\"resize\", this.position.bind(this)); //just in case\r\n        $(window).on(\"resize\", this.position.bind(this)); //when an element with href is pressed, but page hasn't been reloaded\r\n    }.bind(this));\r\n\r\n    this.position();\r\n};\r\n\r\n//set position when the window is resized\r\nModalWindow.prototype.position = function () {\r\n    var self = this;\r\n\r\n    setTimeout(function () { //To prevent multiple executions\r\n        var win = $(window);\r\n\r\n        if (self.elem.width() > win.width()) {\r\n            self.elem.css({\r\n                position: \"absolute\",\r\n                top: win.scrollTop() + 30 + \"px\",\r\n                left: \"0px\"\r\n            });\r\n        } else if (self.elem.height()+30 > win.height()) {\r\n            self.elem.css({\r\n                position: \"absolute\",\r\n                top: win.scrollTop() + \"px\",\r\n                left: win.scrollLeft() + win.width()/2 - self.elem.width()/2 + \"px\",\r\n            });\r\n        } else {\r\n            self.elem.css({\r\n                position: \"fixed\",\r\n                top: \"30px\",\r\n                left: win.scrollLeft() + win.width()/2 - self.elem.width()/2 + \"px\",\r\n            });\r\n        };\r\n\r\n        self.elem.css({\r\n            visibility: \"visible\"\r\n        });\r\n    }, 0);\r\n};\r\n\r\nModalWindow.prototype.close = function () {\r\n    $(\".mod\").remove();\r\n    \r\n    this.preventScrolling(false);\r\n};\r\n\r\nModalWindow.prototype.preventScrolling = function (prevent) {\r\n    var doc = $(document);\r\n    \r\n    $(document.body).css({\r\n        overflow: prevent ? \"hidden\" : \"visible\"\r\n    });\r\n    \r\n    if (prevent) {\r\n        var background = $(\"<div class='dim-background'></div>\");\r\n        background.css({\r\n            position: \"absolute\",\r\n            top: 0,\r\n            left: 0,\r\n            width: \"100%\",\r\n            height: doc.height(),\r\n            background: \"rgba(0,0,0,.5)\",\r\n            zIndex: 2\r\n        });\r\n        $(document.body).append(background);\r\n    } else {\r\n        $(\".dim-background\").remove();\r\n    }\r\n};\r\n\r\nexport {Details, Dialog, AuthWindow, ModalWindow};\n\n\n/** WEBPACK FOOTER **\n ** ./modals.js\n **/","\"use strict\";\r\n\r\n//DB------------------------------------------------------------------------------------------------------------------------------------------------------------\r\nfunction makeDBSearchRequest (reqStr, callback) {\r\n    $.ajax({\r\n        url: reqStr,\r\n        type: \"GET\",\r\n        dataType: \"json\"\r\n    })\r\n    .done(function (json) {\r\n        callback(null, json);\r\n    })\r\n    .fail(function (xhr, status, err) {\r\n        callback(err);\r\n    });\r\n};\r\n\r\nfunction makeDBSaveRequest (reqStr, data, callback) {\r\n    $.ajax({\r\n        url: reqStr,\r\n        type: \"POST\",\r\n        data: data,\r\n        statusCode:{\r\n            200: function () {\r\n                callback(null)\r\n            },\r\n            403: function (jqXHR) {\r\n                callback(JSON.parse(jqXHR.responseText));\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\nfunction makeDBDelRequest (reqStr, callback) {\r\n    $.ajax({\r\n        url: reqStr,\r\n        type: \"POST\",\r\n        statusCode:{\r\n            200: function () {\r\n                callback(null)\r\n            },\r\n            404: function (jqXHR) {\r\n                callback(JSON.parse(jqXHR.responseText));\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\n//Files--------------------------------------------------------------------------------------------------------------------------------------------------------\r\nfunction makeFileSaveRequest(reqStr, file, callback) {\r\n    $.ajax({\r\n        url: reqStr,\r\n        type: \"POST\",\r\n        data: file,\r\n        headers: {\r\n            \"x-file-name\": file.name || file //file may be a file or a string with a file name\r\n        },\r\n        processData: false,\r\n        contentType: false,\r\n        statusCode:{\r\n            200: function () {\r\n                callback(null)\r\n            },\r\n            403: function (jqXHR) {\r\n                callback(JSON.parse(jqXHR.responseText));\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\nfunction makeFileDeleteRequest(reqStr, callback) {\r\n    $.ajax({\r\n        url: reqStr,\r\n        type: \"GET\"\r\n    })\r\n    .done(function () {\r\n        callback();\r\n    })\r\n    .fail(function (xhr, status, err) {\r\n        callback(err);\r\n    });\r\n}\r\n\r\nfunction makeListRequest(reqStr, callback) {\r\n    $.ajax({\r\n        url: reqStr,\r\n        type: \"GET\",\r\n        dataType: \"json\"\r\n    })\r\n    .done(function (json) {\r\n        callback(null, json);\r\n    })\r\n    .fail(function (xhr, status, err) {\r\n        callback(err);\r\n    });\r\n};\r\n\r\n//Registration and authorization------------------------------------------------------------------------------------------------------------------------------------\r\nfunction makeAuthorizationRequest (reqStr, form, callback) {\r\n    $.ajax({\r\n        url: reqStr,\r\n        type: \"POST\",\r\n        data: form ? form.serialize() : null,\r\n    })\r\n    .done(function (json) {\r\n        callback(null, json);\r\n    })\r\n    .fail(function (xhr, status, err) {\r\n        callback(JSON.parse(xhr.responseText));\r\n    });;\r\n};\r\n\r\nexport {makeDBSearchRequest, \r\n        makeDBSaveRequest, \r\n        makeDBDelRequest, \r\n        makeFileSaveRequest, \r\n        makeFileDeleteRequest, \r\n        makeListRequest, \r\n        makeAuthorizationRequest};\n\n\n/** WEBPACK FOOTER **\n ** ./ajaxClient.js\n **/","\"use strict\";\r\n\r\n//findTarget(initial target from event.target, class or id to define the target, element inside the target that will be returned instead of target - optional)\r\nfunction findTarget(target, criteria, tag) {\r\n    criteria = criteria.split(\" \");\r\n\r\n    do {\r\n        for (var i = 0; i < criteria.length; i++) {\r\n            if ((target.hasClass(criteria[i])) || (target.attr(\"id\") === criteria[i])) {\r\n                if (tag) return target.children(tag);\r\n                else return target;\r\n            };\r\n        };\r\n        target = target.parent();\r\n    } while (target.length);\r\n};\r\n\r\n//for some reason sometimes properties are read in the opposite order\r\nfunction gatherItemsInOrder(obj) {\r\n    var items = [];\r\n    for(var item in obj){\r\n        items.push(item);\r\n    };\r\n    return items;\r\n};\r\n\r\nexport {findTarget, gatherItemsInOrder};\n\n\n/** WEBPACK FOOTER **\n ** ./axillaries.js\n **/","\"use strict\";\r\n\r\nimport {findTarget} from \"./axillaries\";\r\nimport {makeDBSearchRequest} from \"./ajaxClient\";\r\n\r\n//SearchPanel----------------------------------------------------------------------------------------------------------------------\r\nexport default function SearchPanel(options) {\r\n    this.elem = $(\".search-panel\");\r\n    this.toggleButton = $(\".search-button\");\r\n    this.form = this.elem.find(\"form\");\r\n    this.input = this.elem.find(\"#search-input\");\r\n\r\n    this.setEvents();\r\n\r\n    this.popups = {};\r\n    if (options.popups) {\r\n        for (var i = 0; i < options.popups.length; i++) {\r\n            this.popups[options.popups[i]] = new SearchPanelPopupControl(options.popups[i], this.elem);\r\n        };\r\n    };\r\n};\r\n\r\nSearchPanel.prototype.setEvents = function () {\r\n\r\n    this.toggleButton.on(\"click\", this.toggle.bind(this));\r\n\r\n    $(document.documentElement).on(\"keydown\", this, function (event) {\r\n        if (event.keyCode === 70 && event.ctrlKey && event.shiftKey) event.data.toggle();\r\n    });\r\n\r\n    this.elem.on(\"click\", this.hidePopups.bind(this));\r\n\r\n    $(\".search-panel__hide-button\").on(\"click\", this.toggle.bind(this));\r\n\r\n    this.form.on(\"submit\", this.submit.bind(this));\r\n\r\n};\r\n\r\nSearchPanel.prototype.unsetEvents = function () {\r\n    $(document.documentElement).off(\"click keydown\", this.hide);\r\n};\r\n\r\nSearchPanel.prototype.toggle = function () {\r\n    var self = this;\r\n\r\n    this.elem.toggleClass(\"zero-width\");\r\n\r\n    if (!this.elem.hasClass(\"zero-width\")) {\r\n        setTimeout(function () {\r\n            $(document.documentElement).on(\"click keydown\", self, self.hide);\r\n        }, 0);\r\n    } else {\r\n        this.hidePopups();\r\n        this.unsetEvents();\r\n    };\r\n};\r\n\r\nSearchPanel.prototype.hide = function (event) {\r\n    var target = findTarget($(event.target), \"search-panel search-panel__popup-panel\");\r\n    if (target) return;\r\n\r\n    var self = event.data;\r\n\r\n    if (event.keyCode && event.keyCode !== 27) return;\r\n\r\n    self.toggle();\r\n    self.hidePopups(event);\r\n};\r\n\r\nSearchPanel.prototype.hidePopups = function (event) {\r\n    //if (event && $(event.target).closest(\".search-panel__control-popup\").length) return;\r\n    if (event && findTarget($(event.target), \"search-panel__control-popup search-panel__popup-panel\")) return;\r\n\r\n    for (let i in this.popups) {\r\n        this.popups[i].hide();\r\n    };\r\n};\r\n\r\nSearchPanel.prototype.submit = function (event) {\r\n    var self = this;\r\n\r\n    if (event) event.preventDefault();\r\n\r\n    var request = this.form.serialize();\r\n    \r\n    if (!this.input.val().length) return;\r\n\r\n    var searchData = {};\r\n    for (let popup in this.popups) {\r\n        searchData[popup] = this.popups[popup].getData();\r\n    };\r\n    \r\n    var config,\r\n        data;\r\n\r\n    async.parallel([\r\n        function (callback) {\r\n            if (!shop.storedConfig) makeDBSearchRequest(\"/dbsearch?db=Config\", callback);\r\n            else callback();\r\n        },\r\n        function (callback) {\r\n            makeSearchRequest(request, searchData, callback, self.showSearchResult);\r\n        }\r\n    ], (function (err, results) {\r\n        if (event) this.toggle();\r\n        \r\n        if (results[0]) {\r\n            shop.storedConfig = config = shop.parseConfig(results[0][0]);\r\n        };\r\n        \r\n        //createContent(null, config || storedConfig);\r\n        if (shop.thumbnails) {\r\n            shop.thumbnails.clear();\r\n            shop.thumbnails.data.url = \"search\";\r\n        };\r\n\r\n        shop.socket.send(JSON.stringify({\r\n            request: \"/searchResults\"\r\n        }));\r\n    }).bind(this));\r\n};\r\n\r\nSearchPanel.prototype.showSearchResult = function (data, done) {\r\n    if (!shop.thumbnails) {\r\n        shop.thumbnails = new shop.Thumbnails(\"#commodity-list\", shop.storedData, shop.storedConfig);\r\n        shop.thumbnails.data.url = \"search\";\r\n    }\r\n    shop.thumbnails.add(data, done);\r\n};\r\n\r\n//SearchPanelPopupControl-------------------------------------------------------------------------------------------------------\r\nfunction SearchPanelPopupControl (name, parent) {\r\n    this.elem = $(\"<div class='search-panel__popup'></div>\");\r\n    this.name = name;\r\n    this.parent = parent;\r\n\r\n    this.create();\r\n    this.render();\r\n\r\n    Object.defineProperty(this, \"data\", {\r\n        get: function () {\r\n            this.body.submit();\r\n            return this._data;\r\n        }\r\n    });\r\n};\r\n\r\nSearchPanelPopupControl.prototype.create = function () {\r\n    var self = this;\r\n\r\n    this.button = $(\r\n        '<div class=\"search-panel__control-popup\">\\\r\n            <p class=\"search-panel__control-popup__text\">' + this.name + '</p>\\\r\n            <span class=\"glyphicon glyphicon-chevron-down search-panel__control-popup__icon\" aria-hidden=\"true\"></span>\\\r\n        </div>');\r\n\r\n    this.body = $(\r\n        \"<form class='search-panel__popup-panel zero-display'>\\\r\n            <div class='row'></div>\\\r\n        </form>\");\r\n\r\n    this.getValues(function (err, values) {\r\n        let col = createCol();\r\n\r\n        let i = 1;\r\n        for (var value in values) {\r\n            col.append(\"<label class='checkbox'><input type='checkbox' name='\" + value + \"'>\" + value + \"</label>\");\r\n            if (i++ % 20 === 0) col = createCol();\r\n        };\r\n        self.bodyWidth = Math.ceil(i/20)*250;\r\n        self.body.css({\r\n            width: self.bodyWidth + \"px\"\r\n        });\r\n        $(\".col\").addClass(\"col-xs-\" + (12/Math.ceil(i/20)));\r\n\r\n        $(window).on(\"resize\", self.handleBodySize.bind(self));\r\n\r\n        function createCol() {\r\n            let row = self.body.find(\".row\"),\r\n                col = $(\"<div class='col'></div>\");\r\n            row.append(col);\r\n            return col;\r\n        };\r\n    });\r\n\r\n    this.elem.append(this.button);\r\n    //this.elem.append(this.body);\r\n    $(document.body).append(this.body);\r\n\r\n    this.setEvents();\r\n};\r\n\r\nSearchPanelPopupControl.prototype.getValues = function (callback) {\r\n    makeDBSearchRequest(\"/dbsearch?db=Commodity&field=specs.\" + this.name, callback);\r\n};\r\n\r\nSearchPanelPopupControl.prototype.setEvents = function () {\r\n    this.button.on(\"click\", this.toggle.bind(this));\r\n    this.body.on(\"click\", this.hide.bind(this));\r\n};\r\n\r\nSearchPanelPopupControl.prototype.render = function () {\r\n    this.parent.append(this.elem);\r\n};\r\n\r\nSearchPanelPopupControl.prototype.toggle = function () {\r\n    this.body.toggleClass(\"zero-display\");\r\n    this.handleBodySize();\r\n};\r\n\r\nSearchPanelPopupControl.prototype.hide = function (event) {\r\n    if (event && findTarget($(event.target), \"col\")) return;\r\n\r\n    this.body.addClass(\"zero-display\");\r\n};\r\n\r\nSearchPanelPopupControl.prototype.handleBodySize = function () {\r\n    clearTimeout(this.handleBodySizeTimer);\r\n    let self = this;\r\n\r\n    this.handleBodySizeTimer = setTimeout(function () {\r\n        let win = $(window);\r\n\r\n        self.body.css({\r\n            top: self.button.offset().top + self.button.outerHeight(),\r\n            right: 0\r\n        })\r\n\r\n        if (self.body.position().top + self.body.height() > win.height()) {\r\n            self.body.css({\r\n                position: \"absolute\"\r\n            })\r\n        } else {\r\n            self.body.css({\r\n                position: \"fixed\"\r\n            })\r\n        };\r\n\r\n        if (win.width() > self.bodyWidth) {\r\n            self.body.css({\r\n                width: self.bodyWidth + \"px\"\r\n            });\r\n        } else {\r\n            self.body.css({\r\n                width: win.width() + \"px\"\r\n            });\r\n        };\r\n    }, 100);\r\n};\r\n\r\nSearchPanelPopupControl.prototype.getData = function () {\r\n    this._data = this.body.serializeArray();\r\n    return this._data;\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./searchPanel.js\n **/"],"sourceRoot":""}